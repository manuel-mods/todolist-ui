<!-- Page Header -->
<app-page-header 
  *ngIf="project() && !loading() && !error()"
  [title]="project()?.name || 'Project'"
  [subtitle]="project()?.description || 'Project management board'"
  [actions]="headerActions"
  [showFilters]="showFilters()">
  
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item"><a routerLink="/projects" class="text-decoration-none">Projects</a></li>
      <li class="breadcrumb-item active">{{ project()?.name }}</li>
    </ol>
  </nav>
  
  <!-- Filters Panel -->
  <div class="card card-notion">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label small fw-medium">Assignee</label>
          <select class="form-select form-select-sm" [(ngModel)]="filters.assignee" (change)="applyFilters()">
            <option value="">All Assignees</option>
            <option *ngFor="let user of users()" [value]="user.id">{{ user.name }}</option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label small fw-medium">Priority</label>
          <select class="form-select form-select-sm" [(ngModel)]="filters.priority" (change)="applyFilters()">
            <option value="">All Priorities</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label small fw-medium">Labels</label>
          <select class="form-select form-select-sm" [(ngModel)]="filters.label" (change)="applyFilters()">
            <option value="">All Labels</option>
            <!-- TODO: Add labels from project -->
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label small fw-medium">Due Date</label>
          <select class="form-select form-select-sm" [(ngModel)]="filters.dueDate" (change)="applyFilters()">
            <option value="">All Tasks</option>
            <option value="overdue">Overdue</option>
            <option value="today">Due Today</option>
            <option value="week">Due This Week</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label small fw-medium">Search</label>
          <input type="text" class="form-control form-control-sm" 
                 placeholder="Search tasks..." 
                 [(ngModel)]="filters.search"
                 (keyup)="applyFilters()">
        </div>
      </div>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <div class="d-flex gap-2">
          <button class="btn btn-outline-secondary btn-sm" (click)="clearFilters()">
            <i class="fas fa-times me-1"></i>Clear All
          </button>
        </div>
        <small class="text-muted">{{ getFilteredTasks().length }} of {{ tasks().length }} tasks shown</small>
      </div>
    </div>
  </div>
</app-page-header>

<!-- Error State -->
<div class="container-fluid px-4" *ngIf="error() && !loading()">
  <div class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ error() }}
    <button class="btn btn-outline-danger btn-sm ms-3" (click)="loadProjectData(projectId())">
      <i class="fas fa-redo me-1"></i>Try Again
    </button>
  </div>
</div>

<!-- Shared Kanban Board Component -->
<app-kanban-board
  *ngIf="project() && !error()"
  [tasks]="getFilteredTasks()"
  [projects]="[project()!]"
  [users]="users()"
  [loading]="loading()"
  [showProject]="false"
  [allowCreateTask]="true"
  (taskStatusChanged)="onTaskStatusChanged($event)"
  (taskCreated)="onTaskCreated($event)"
  (taskUpdated)="onTaskUpdated($event)">
</app-kanban-board>