<!-- Page Header -->
<app-page-header 
  title="Dashboard" 
  subtitle="Welcome back! Here's what's happening with your projects."
  [actions]="headerActions">
</app-page-header>

<!-- Loading State -->
<div class="d-flex justify-content-center align-items-center" style="height: 400px;" *ngIf="loading()">
  <div class="text-center">
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted">Loading dashboard...</p>
  </div>
</div>

<!-- Dashboard Content -->
<div class="container-fluid px-4 py-4" *ngIf="!loading()">
  <!-- Task Statistics Cards -->
  <div class="row g-4 mb-5">
    <div class="col-sm-6 col-lg-3">
      <div class="card card-notion h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <div class="bg-danger bg-opacity-10 rounded-circle p-3">
                <i class="fas fa-exclamation-circle text-danger"></i>
              </div>
            </div>
            <div class="flex-grow-1 ms-3">
              <div class="fs-6 text-muted">Priority Tasks</div>
              <div class="fs-4 fw-bold">{{ taskStats().priority }}</div>
              <small class="text-muted">of {{ taskStats().total }} total</small>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-sm-6 col-lg-3">
      <div class="card card-notion h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <div class="bg-warning bg-opacity-10 rounded-circle p-3">
                <i class="fas fa-clock text-warning"></i>
              </div>
            </div>
            <div class="flex-grow-1 ms-3">
              <div class="fs-6 text-muted">Upcoming Tasks</div>
              <div class="fs-4 fw-bold">{{ taskStats().upcoming }}</div>
              <small class="text-muted">due this week</small>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-sm-6 col-lg-3">
      <div class="card card-notion h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <div class="bg-primary bg-opacity-10 rounded-circle p-3">
                <i class="fas fa-calendar-alt text-primary"></i>
              </div>
            </div>
            <div class="flex-grow-1 ms-3">
              <div class="fs-6 text-muted">Overdue Tasks</div>
              <div class="fs-4 fw-bold">{{ taskStats().overdue }}</div>
              <small class="text-muted">need attention</small>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-sm-6 col-lg-3">
      <div class="card card-notion h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <div class="bg-success bg-opacity-10 rounded-circle p-3">
                <i class="fas fa-tasks text-success"></i>
              </div>
            </div>
            <div class="flex-grow-1 ms-3">
              <div class="fs-6 text-muted">Created Tasks</div>
              <div class="fs-4 fw-bold">{{ taskStats().pending }}</div>
              <small class="text-muted">ready to start</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Projects -->
  <div class="row">
    <div class="col-lg-8">
      <div class="card card-notion">
        <div class="card-header bg-transparent">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold">Recent Projects</h5>
            <a routerLink="/projects" class="btn btn-outline-primary btn-sm">View All</a>
          </div>
        </div>
        <div class="card-body">
          <div class="row g-3" *ngIf="recentProjects().length > 0; else emptyProjects">
            <div class="col-md-6" *ngFor="let project of recentProjects()">
              <div class="card border hover-lift" style="cursor: pointer;" [routerLink]="['/projects', project.id]">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title mb-0">{{ project.name }}</h6>
                    <span class="badge bg-primary">{{ project.tasksCount }} tasks</span>
                  </div>
                  <p class="card-text text-muted small">{{ project.description }}</p>
                  <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">{{ project.completedTasks }} of {{ project.tasksCount }} completed</small>
                  </div>
                  <small class="text-muted">Updated {{ project.updatedAt | date:'short' }}</small>
                </div>
              </div>
            </div>
          </div>
          
          <ng-template #emptyProjects>
            <div class="text-center py-5">
              <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
              <h5>No Recent Projects</h5>
              <p class="text-muted">Create your first project to get started</p>
              <a routerLink="/projects" class="btn btn-primary">Create Project</a>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
    
    <!-- Activity Feed -->
    <div class="col-lg-4">
      <div class="card card-notion">
        <div class="card-header bg-transparent">
          <h5 class="mb-0 fw-bold">Recent Activity</h5>
        </div>
        <div class="card-body">
          <div class="list-group list-group-flush">
            <div class="list-group-item border-0 px-0" *ngFor="let activity of recentActivity()">
              <div class="d-flex">
                <div class="flex-shrink-0">
                  <div class="bg-light rounded-circle p-2">
                    <i class="fas fa-check text-success" style="font-size: 0.75rem;"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <div class="small">{{ activity.description }}</div>
                  <small class="text-muted">{{ activity.createdAt | date:'short' }}</small>
                </div>
              </div>
            </div>
          </div>
          
          <div class="text-center py-4" *ngIf="!recentActivity()?.length">
            <i class="fas fa-history fa-2x text-muted mb-2"></i>
            <p class="text-muted small">No recent activity</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>