import{a as le}from"./chunk-4PCLMG4A.js";import"./chunk-IRWHQV2Y.js";import"./chunk-ITIMRF4J.js";import{c as re}from"./chunk-OFQQDMTS.js";import{a as ne}from"./chunk-SVIYRKC5.js";import{a as te}from"./chunk-WKW57PVX.js";import{b as se}from"./chunk-P2AP2LDR.js";import{b as U,d as H,e as K,g as Y,i as q,j as Q,k as W,l as J,m as X,o as Z,q as ee}from"./chunk-B6CTW34R.js";import{a as ie,b as ae}from"./chunk-TB2JPHKQ.js";import"./chunk-5IMW6SUT.js";import{h as z,r as G}from"./chunk-UEBHN7X3.js";import{$b as j,Ab as F,Bc as O,Cb as i,Cc as M,Db as t,Dc as A,Eb as g,Fb as C,Fc as V,Gb as u,Gc as R,Ha as v,Hb as m,Hc as B,Ic as $,Qb as a,Rb as p,Sb as k,Tb as y,Ub as P,a as S,ac as E,b as T,bc as L,cb as l,cc as N,d as w,dc as D,ma as b,mb as I,qb as x,ua as f,va as _,xb as d}from"./chunk-HT5E4KE5.js";var de=(r,n,e)=>({"bg-danger":r,"bg-warning":n,"bg-success":e});function me(r,n){if(r&1&&(i(0,"option",37),a(1),t()),r&2){let e=n.$implicit;d("value",e.id),l(),k(" ",e.name," ")}}function pe(r,n){r&1&&(i(0,"div",38)(1,"div",39)(2,"div",40)(3,"span",41),a(4,"Loading..."),t()(),i(5,"p",33),a(6,"Loading tasks..."),t()()())}function ge(r,n){if(r&1&&(i(0,"div",42)(1,"div",43),g(2,"i",44),a(3),t()()),r&2){let e=m();l(3),k("",e.error()," ")}}function ue(r,n){if(r&1&&(i(0,"small",33),a(1),E(2,"slice"),t()),r&2){let e=m().$implicit;l(),y(" ",D(2,2,e.description,0,50),"",e.description&&e.description.length>50?"...":""," ")}}function fe(r,n){if(r&1&&(i(0,"span",82),a(1),t()),r&2){let e=n.$implicit;l(),p(e)}}function _e(r,n){if(r&1&&(i(0,"span",83),a(1),t()),r&2){let e=m(2).$implicit;l(),k("+",e.labels.length-3,"")}}function ve(r,n){if(r&1&&(i(0,"div",79),x(1,fe,2,1,"span",80)(2,_e,2,1,"span",81),t()),r&2){let e=m().$implicit;l(),d("ngForOf",e.labels.slice(0,3)),l(),d("ngIf",e.labels&&e.labels.length>3)}}function xe(r,n){if(r&1&&(i(0,"div",84)(1,"small",33),g(2,"i",85),a(3),t()()),r&2){let e=m().$implicit,s=m(2);l(3),y("",s.getSubtaskCount(e)," subtask",s.getSubtaskCount(e)===1?"":"s"," ")}}function ke(r,n){if(r&1&&(i(0,"div",86)(1,"div",87),a(2),t(),i(3,"span",88),a(4),t()()),r&2){let e=m().$implicit,s=m(2);l(2),p(s.getAssigneeInitials(e.assignedTo)),l(2),p(s.getAssigneeName(e.assignedTo))}}function be(r,n){r&1&&(i(0,"span",89),a(1,"Unassigned"),t())}function he(r,n){if(r&1&&(i(0,"span"),a(1),E(2,"date"),t()),r&2){let e=m().$implicit,s=m(2);F(s.getDueDateClass(e.dueDate)),l(),k(" ",N(2,3,e.dueDate,"MMM d")," ")}}function Se(r,n){r&1&&(i(0,"span",33),a(1,"No due date"),t())}function Te(r,n){if(r&1){let e=C();i(0,"tr",61),u("click",function(){let o=f(e).$implicit,c=m(2);return _(c.openTaskDetail(o))}),i(1,"td")(2,"div")(3,"div",62),a(4),t(),x(5,ue,3,6,"small",63)(6,ve,3,2,"div",64)(7,xe,4,2,"div",65),t()(),i(8,"td")(9,"span",66),a(10),t()(),i(11,"td")(12,"span",67),a(13),t()(),i(14,"td")(15,"span",68),a(16),E(17,"titlecase"),t()(),i(18,"td"),x(19,ke,5,2,"div",69)(20,be,2,0,"span",70),t(),i(21,"td"),x(22,he,3,6,"span",71)(23,Se,2,0,"span",63),t(),i(24,"td")(25,"div",72),u("click",function(o){return f(e),_(o.stopPropagation())}),i(26,"button",73),g(27,"i",74),t(),i(28,"ul",75)(29,"li")(30,"a",76),u("click",function(){let o=f(e).$implicit,c=m(2);return _(c.editTask(o))}),a(31,"Edit"),t()(),i(32,"li")(33,"a",76),u("click",function(){let o=f(e).$implicit,c=m(2);return _(c.assignTask(o))}),a(34,"Assign"),t()(),i(35,"li")(36,"a",76),u("click",function(){let o=f(e).$implicit,c=m(2);return _(c.changeStatus(o))}),a(37,"Change Status"),t()(),i(38,"li"),g(39,"hr",77),t(),i(40,"li")(41,"a",78),u("click",function(){let o=f(e).$implicit,c=m(2);return _(c.deleteTask(o))}),a(42,"Delete"),t()()()()()()}if(r&2){let e=n.$implicit,s=m(2);l(4),p(e.title),l(),d("ngIf",e.description),l(),d("ngIf",e.labels&&e.labels.length>0),l(),d("ngIf",s.getSubtaskCount(e)>0),l(3),p(s.getProjectName(e.projectId)),l(2),d("ngClass","status-"+e.status.toLowerCase().replace("_","-")),l(),k(" ",s.getStatusLabel(e.status)," "),l(2),d("ngClass",j(15,de,e.priority==="high",e.priority==="medium",e.priority==="low")),l(),k(" ",L(17,13,e.priority)," "),l(3),d("ngIf",e.assignedTo),l(),d("ngIf",!e.assignedTo),l(2),d("ngIf",e.dueDate),l(),d("ngIf",!e.dueDate)}}function Ce(r,n){if(r&1){let e=C();i(0,"div",90),g(1,"i",91),i(2,"h5"),a(3,"No Tasks Found"),t(),i(4,"p",33),a(5,"No tasks match your current filters."),t(),i(6,"button",92),u("click",function(){f(e);let o=m(2);return _(o.clearFilters())}),a(7,"Clear Filters"),t()()}}function Ee(r,n){if(r&1){let e=C();i(0,"div",93)(1,"nav")(2,"div",94)(3,"small",33),a(4),t(),i(5,"div",95)(6,"button",96),u("click",function(){f(e);let o=m(2);return _(o.currentPage=o.currentPage-1)}),g(7,"i",97),t(),i(8,"button",96),u("click",function(){f(e);let o=m(2);return _(o.currentPage=o.currentPage+1)}),g(9,"i",98),t()()()()()}if(r&2){let e=m(2);l(4),P(" Showing ",(e.currentPage-1)*e.pageSize+1," to ",e.Math.min(e.currentPage*e.pageSize,e.getFilteredTasks().length)," of ",e.getFilteredTasks().length," tasks "),l(2),d("disabled",e.currentPage===1),l(2),d("disabled",e.currentPage*e.pageSize>=e.getFilteredTasks().length)}}function ye(r,n){if(r&1&&(i(0,"div",45)(1,"div",46)(2,"div",47)(3,"div",48)(4,"div",2)(5,"div",49),a(6),t(),i(7,"small",33),a(8,"Created"),t()()()(),i(9,"div",47)(10,"div",48)(11,"div",2)(12,"div",50),a(13),t(),i(14,"small",33),a(15,"In Progress"),t()()()(),i(16,"div",47)(17,"div",48)(18,"div",2)(19,"div",51),a(20),t(),i(21,"small",33),a(22,"Blocked"),t()()()(),i(23,"div",47)(24,"div",48)(25,"div",2)(26,"div",52),a(27),t(),i(28,"small",33),a(29,"Testing"),t()()()(),i(30,"div",47)(31,"div",48)(32,"div",2)(33,"div",53),a(34),t(),i(35,"small",33),a(36,"Ready to Finish"),t()()()(),i(37,"div",47)(38,"div",48)(39,"div",2)(40,"div",54),a(41),t(),i(42,"small",33),a(43,"Finished"),t()()()()(),i(44,"div",1)(45,"div",55)(46,"table",56)(47,"thead",57)(48,"tr")(49,"th"),a(50,"Task"),t(),i(51,"th"),a(52,"Project"),t(),i(53,"th"),a(54,"Status"),t(),i(55,"th"),a(56,"Priority"),t(),i(57,"th"),a(58,"Assignee"),t(),i(59,"th"),a(60,"Due Date"),t(),i(61,"th"),a(62,"Actions"),t()()(),i(63,"tbody"),x(64,Te,43,19,"tr",58),t()()(),x(65,Ce,8,0,"div",59)(66,Ee,10,5,"div",60),t()()),r&2){let e=m();l(6),p(e.getTasksByStatus("CREATED").length),l(7),p(e.getTasksByStatus("IN_PROGRESS").length),l(7),p(e.getTasksByStatus("BLOCKED").length),l(7),p(e.getTasksByStatus("TESTING").length),l(7),p(e.getTasksByStatus("READY_TO_FINISH").length),l(7),p(e.getTasksByStatus("FINISHED").length),l(23),d("ngForOf",e.getFilteredTasks()),l(),d("ngIf",e.getFilteredTasks().length===0),l(),d("ngIf",e.getFilteredTasks().length>e.pageSize)}}var oe=class r{taskService=b(ne);projectService=b(ie);authService=b(G);fb=b(Z);router=b(z);modalService=b(se);allTasks=v([]);projects=v([]);users=v([]);filteredTasks=v([]);loading=v(!0);error=v(null);selectedProject=v(null);selectedStatus=v(null);searchQuery=v("");TaskStatus=te;showFilters=!1;currentPage=1;pageSize=20;totalTasks=0;filterForm;headerActions=[{label:"New Task",icon:"fas fa-plus",action:()=>this.createTask(),variant:"primary"},{label:"Filters",icon:"fas fa-filter",action:()=>this.toggleFilters(),variant:"outline"}];constructor(){this.filterForm=this.fb.group({project:[""],status:[""],priority:[""],assignee:[""],labels:[""],search:[""]}),this.filterForm.valueChanges.subscribe(n=>{this.applyFilters(n)})}toggleFilters(){this.showFilters=!this.showFilters}createTask(){let n=this.modalService.open(re,{size:"lg",backdrop:"static"});n.componentInstance.projects=this.projects(),n.componentInstance.users=this.users(),n.componentInstance.defaultStatus="CREATED",n.result.then(e=>{e&&this.loadData()}).catch(()=>{})}openTaskDetail(n){let e=this.modalService.open(le,{size:"fullscreen",backdrop:"static",windowClass:"fullscreen-modal-window"});e.componentInstance.task=S({},n),e.componentInstance.projects=this.projects(),e.componentInstance.users=this.users(),e.result.then(s=>{s&&!s.deleted?(this.allTasks.update(o=>o.map(c=>c.id===s.id?T(S({},s),{projectName:c.projectName}):c)),this.applyFilters(this.filterForm.value)):s&&s.deleted&&(this.allTasks.update(o=>o.filter(c=>c.id!==n.id)),this.applyFilters(this.filterForm.value))}).catch(()=>{})}getProjectName(n){return this.projects().find(s=>s.id===n)?.name||"Unknown Project"}getStatusLabel(n){return n.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}getAssigneeInitials(n){return n.substring(0,2).toUpperCase()}getAssigneeName(n){return"User "+n}getDueDateClass(n){let e=new Date,s=new Date(n);return s<e?"text-danger fw-bold":s.getTime()-e.getTime()<24*60*60*1e3?"text-warning fw-bold":"text-muted"}getFilteredTasks(){return this.filteredTasks()}filteredTasksCount(){return this.filteredTasks().length}Math=Math;getTasksByStatus(n){return this.filteredTasks().filter(e=>e.status===n)}editTask(n){this.openTaskDetail(n)}assignTask(n){console.log("Assign task:",n)}changeStatus(n){console.log("Change status:",n)}deleteTask(n){this.openTaskDetail(n)}ngOnInit(){this.loadData()}loadData(){return w(this,null,function*(){this.loading.set(!0),this.error.set(null);try{let n=this.authService.getCurrentUser();if(!n){this.loading.set(!1);return}let e=yield this.projectService.getUserProjects(n.id).toPromise();if(!e){this.loading.set(!1);return}let s=[...e.owned,...e.shared];this.projects.set(s);let o=[];for(let c of s)if(c.tasks){let h=c.tasks.map(ce=>T(S({},ce),{projectName:c.name}));o.push(...h)}this.allTasks.set(o),this.filteredTasks.set(o),this.loading.set(!1)}catch(n){console.error("Error loading task data:",n),this.error.set("Failed to load tasks"),this.loading.set(!1)}})}applyFilters(n){let e=[...this.allTasks()];if(n.project&&(e=e.filter(s=>s.projectId===parseInt(n.project))),n.status&&(e=e.filter(s=>s.status===n.status)),n.priority&&(e=e.filter(s=>s.priority===n.priority)),n.assignee&&(e=e.filter(s=>s.assignedTo===n.assignee)),n.labels){let s=n.labels.toLowerCase();e=e.filter(o=>o.labels&&o.labels.some(c=>c.toLowerCase().includes(s)))}if(n.search){let s=n.search.toLowerCase();e=e.filter(o=>o.title.toLowerCase().includes(s)||o.description?.toLowerCase().includes(s)||o.labels&&o.labels.some(c=>c.toLowerCase().includes(s)))}this.filteredTasks.set(e)}updateTaskStatus(n,e){let s=this.authService.getCurrentUser();s&&this.taskService.updateTaskStatus(n.id,{newStatus:e,userId:s.id}).subscribe({next:o=>{this.allTasks.update(c=>c.map(h=>h.id===n.id?T(S({},o),{projectName:h.projectName}):h)),this.applyFilters(this.filterForm.value)},error:o=>{this.error.set(o.message||"Failed to update task status")}})}clearFilters(){this.filterForm.reset()}getSubtaskCount(n){return this.allTasks().filter(e=>e.parentTaskId===n.id).length}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-task-list"]],decls:65,vars:8,consts:[["title","All Tasks","subtitle","View and manage all your tasks across projects",3,"actions","showFilters"],[1,"card","card-notion"],[1,"card-body"],[1,"row","g-3",3,"formGroup"],[1,"col-md-3"],["for","projectFilter",1,"form-label","small","fw-medium"],["id","projectFilter","formControlName","project",1,"form-select","form-select-sm"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-2"],["for","statusFilter",1,"form-label","small","fw-medium"],["id","statusFilter","formControlName","status",1,"form-select","form-select-sm"],["value","CREATED"],["value","IN_PROGRESS"],["value","BLOCKED"],["value","TESTING"],["value","READY_TO_FINISH"],["value","FINISHED"],["for","priorityFilter",1,"form-label","small","fw-medium"],["id","priorityFilter","formControlName","priority",1,"form-select","form-select-sm"],["value","high"],["value","medium"],["value","low"],["for","assigneeFilter",1,"form-label","small","fw-medium"],["id","assigneeFilter","formControlName","assignee",1,"form-select","form-select-sm"],["for","labelsFilter",1,"form-label","small","fw-medium"],["type","text","id","labelsFilter","formControlName","labels","placeholder","Filter by labels...",1,"form-control","form-control-sm"],["for","searchFilter",1,"form-label","small","fw-medium"],["type","text","id","searchFilter","formControlName","search","placeholder","Search tasks...",1,"form-control","form-control-sm"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"fas","fa-times","me-1"],[1,"text-muted"],["class","d-flex justify-content-center align-items-center","style","height: 400px;",4,"ngIf"],["class","container-fluid px-4",4,"ngIf"],["class","container-fluid px-4 py-4",4,"ngIf"],[3,"value"],[1,"d-flex","justify-content-center","align-items-center",2,"height","400px"],[1,"text-center"],["role","status",1,"spinner-border","text-primary","mb-3"],[1,"visually-hidden"],[1,"container-fluid","px-4"],["role","alert",1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"container-fluid","px-4","py-4"],[1,"row","g-4","mb-4"],[1,"col-sm-6","col-lg-2"],[1,"card","card-notion","text-center"],[1,"fs-4","fw-bold","text-secondary"],[1,"fs-4","fw-bold","text-primary"],[1,"fs-4","fw-bold","text-danger"],[1,"fs-4","fw-bold","text-warning"],[1,"fs-4","fw-bold","text-info"],[1,"fs-4","fw-bold","text-success"],[1,"table-responsive"],[1,"table","table-hover","align-middle","mb-0"],[1,"table-light"],["style","cursor: pointer;",3,"click",4,"ngFor","ngForOf"],["class","text-center py-5",4,"ngIf"],["class","card-footer bg-transparent",4,"ngIf"],[2,"cursor","pointer",3,"click"],[1,"fw-medium"],["class","text-muted",4,"ngIf"],["class","mt-1 task-labels",4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"badge","bg-primary"],[1,"badge","badge-status",3,"ngClass"],[1,"badge",3,"ngClass"],["class","d-flex align-items-center",4,"ngIf"],["class","text-muted small",4,"ngIf"],[3,"class",4,"ngIf"],[1,"dropdown",3,"click"],["data-bs-toggle","dropdown",1,"btn","btn-outline-secondary","btn-sm"],[1,"fas","fa-ellipsis-v"],[1,"dropdown-menu"],[1,"dropdown-item",3,"click"],[1,"dropdown-divider"],[1,"dropdown-item","text-danger",3,"click"],[1,"mt-1","task-labels"],["class","badge badge-label",4,"ngFor","ngForOf"],["class","badge bg-secondary",4,"ngIf"],[1,"badge","badge-label"],[1,"badge","bg-secondary"],[1,"mt-1"],[1,"fas","fa-sitemap","me-1"],[1,"d-flex","align-items-center"],[1,"task-assignee","me-2"],[1,"small"],[1,"text-muted","small"],[1,"text-center","py-5"],[1,"fas","fa-tasks","fa-3x","text-muted","mb-3"],[1,"btn","btn-primary",3,"click"],[1,"card-footer","bg-transparent"],[1,"d-flex","justify-content-between","align-items-center"],["role","group",1,"btn-group"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fas","fa-chevron-left"],[1,"fas","fa-chevron-right"]],template:function(e,s){e&1&&(i(0,"app-page-header",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),a(6,"Project"),t(),i(7,"select",6)(8,"option",7),a(9,"All Projects"),t(),x(10,me,2,2,"option",8),t()(),i(11,"div",9)(12,"label",10),a(13,"Status"),t(),i(14,"select",11)(15,"option",7),a(16,"All Statuses"),t(),i(17,"option",12),a(18,"Created"),t(),i(19,"option",13),a(20,"In Progress"),t(),i(21,"option",14),a(22,"Blocked"),t(),i(23,"option",15),a(24,"Testing"),t(),i(25,"option",16),a(26,"Ready to Finish"),t(),i(27,"option",17),a(28,"Finished"),t()()(),i(29,"div",9)(30,"label",18),a(31,"Priority"),t(),i(32,"select",19)(33,"option",7),a(34,"All Priorities"),t(),i(35,"option",20),a(36,"High"),t(),i(37,"option",21),a(38,"Medium"),t(),i(39,"option",22),a(40,"Low"),t()()(),i(41,"div",9)(42,"label",23),a(43,"Assignee"),t(),i(44,"select",24)(45,"option",7),a(46,"All Assignees"),t()()(),i(47,"div",9)(48,"label",25),a(49,"Labels"),t(),g(50,"input",26),t(),i(51,"div",4)(52,"label",27),a(53,"Search"),t(),g(54,"input",28),t()(),i(55,"div",29)(56,"div",30)(57,"button",31),u("click",function(){return s.clearFilters()}),g(58,"i",32),a(59,"Clear All "),t()(),i(60,"small",33),a(61),t()()()()(),x(62,pe,7,0,"div",34)(63,ge,4,1,"div",35)(64,ye,67,9,"div",36)),e&2&&(d("actions",s.headerActions)("showFilters",s.showFilters),l(3),d("formGroup",s.filterForm),l(7),d("ngForOf",s.projects()),l(51),k("",s.filteredTasksCount()," tasks shown"),l(),d("ngIf",s.loading()),l(),d("ngIf",s.error()),l(),d("ngIf",!s.loading()&&!s.error()))},dependencies:[$,O,M,A,B,V,R,ee,Y,J,X,U,W,H,K,q,Q,ae],styles:[".task-labels[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;padding:.25rem .5rem;margin-right:.25rem;margin-bottom:.25rem;border-radius:12px}.badge-label[_ngcontent-%COMP%]:nth-child(5n+1){background-color:#3498db!important;color:#fff}.badge-label[_ngcontent-%COMP%]:nth-child(5n+2){background-color:#e74c3c!important;color:#fff}.badge-label[_ngcontent-%COMP%]:nth-child(5n+3){background-color:#2ecc71!important;color:#fff}.badge-label[_ngcontent-%COMP%]:nth-child(5n+4){background-color:#f39c12!important;color:#fff}.badge-label[_ngcontent-%COMP%]:nth-child(5n+5){background-color:#9b59b6!important;color:#fff}.badge-status.status-created[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.badge-status.status-in-progress[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff}.badge-status.status-blocked[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}.badge-status.status-testing[_ngcontent-%COMP%]{background-color:#fd7e14;color:#fff}.badge-status.status-ready-to-finish[_ngcontent-%COMP%]{background-color:#20c997;color:#fff}.badge-status.status-finished[_ngcontent-%COMP%]{background-color:#198754;color:#fff}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#007bff0d;transition:background-color .2s ease}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{font-size:.9rem}.badge[_ngcontent-%COMP%]{font-size:.6rem;padding:.2rem .4rem}}"]})};export{oe as TaskListComponent};
