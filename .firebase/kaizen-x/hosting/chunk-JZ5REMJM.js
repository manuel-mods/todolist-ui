import{a as ge}from"./chunk-4PCLMG4A.js";import"./chunk-IRWHQV2Y.js";import"./chunk-ITIMRF4J.js";import{a as z,b as H}from"./chunk-BIWH6YEI.js";import"./chunk-OFQQDMTS.js";import{a as le}from"./chunk-SVIYRKC5.js";import"./chunk-WKW57PVX.js";import{b as me,c as pe}from"./chunk-P2AP2LDR.js";import{b as I,d as U,f as V,k as se,l as ae,m as ce,p as D}from"./chunk-B6CTW34R.js";import{a as F,b as de}from"./chunk-TB2JPHKQ.js";import"./chunk-5IMW6SUT.js";import{f as re,h as oe,i as ie,r as E}from"./chunk-UEBHN7X3.js";import{$a as j,Cb as o,Cc as y,Db as i,Dc as S,Eb as _,Fb as P,Gb as u,Ha as b,Hb as d,Ic as T,Mb as B,N as J,Nb as W,Ob as q,P as X,Qb as s,Rb as f,Sb as k,T as Z,Tb as ee,Vb as M,Wb as O,Xb as v,_b as te,a as R,aa as $,b as K,cb as c,d as G,ec as ne,j as Y,ma as C,mb as w,qb as h,t as A,ua as m,va as p,xb as g}from"./chunk-HT5E4KE5.js";function Pe(a,n){if(a&1){let e=P();o(0,"button",14),u("click",function(){m(e);let r=d();return p(r.showAddUser=!r.showAddUser)}),_(1,"i",15),s(2," Agregar Usuario "),i()}}function be(a,n){if(a&1){let e=P();o(0,"div",27),u("click",function(){let r=m(e).$implicit,l=d(3);return p(l.selectUser(r))}),o(1,"div",6),_(2,"img",28),o(3,"div",8)(4,"div",9),s(5),i(),o(6,"div",10),s(7),i()()(),o(8,"button",29),_(9,"i",15),i()()}if(a&2){let e=n.$implicit;c(2),g("src",e.avatar||"default-avatar.png",j)("alt",e.name||e.email),c(3),f(e.name||"Sin nombre"),c(2),f(e.email)}}function Me(a,n){if(a&1&&(o(0,"div",25),h(1,be,10,4,"div",26),i()),a&2){let e=d(2);c(),g("ngForOf",e.searchResults)}}function Oe(a,n){a&1&&(o(0,"div",30),_(1,"i",31),s(2," Buscando... "),i())}function ve(a,n){a&1&&(o(0,"div",32),s(1," No se encontraron usuarios con ese email "),i())}function xe(a,n){if(a&1){let e=P();o(0,"div",16)(1,"div",17)(2,"div",18)(3,"input",19),v("ngModelChange",function(r){m(e);let l=d();return O(l.searchEmail,r)||(l.searchEmail=r),p(r)}),u("input",function(r){m(e);let l=d();return p(l.onSearchInput(r))}),i(),o(4,"button",20),u("click",function(){m(e);let r=d();return p(r.clearSearch())}),_(5,"i",21),i()(),h(6,Me,2,1,"div",22)(7,Oe,3,0,"div",23)(8,ve,2,0,"div",24),i()()}if(a&2){let e=d();c(3),M("ngModel",e.searchEmail),g("disabled",e.isSearching),c(3),g("ngIf",e.searchResults.length>0),c(),g("ngIf",e.isSearching),c(),g("ngIf",e.searchEmail&&!e.isSearching&&e.searchResults.length===0)}}function ke(a,n){if(a&1){let e=P();o(0,"button",36),u("click",function(){m(e);let r=d().$implicit,l=d();return p(l.removeUser(r.id))}),_(1,"i",21),i()}}function je(a,n){if(a&1&&(o(0,"div",33)(1,"div",6),_(2,"img",7),o(3,"div",8)(4,"div",9),s(5),i(),o(6,"div",10),s(7),i(),o(8,"span",34),s(9,"Colaborador"),i()()(),h(10,ke,2,0,"button",35),i()),a&2){let e=n.$implicit,t=d();c(2),g("src",e.user.avatar||"default-avatar.png",j)("alt",e.user.name||e.user.email),c(3),k(" ",e.user.name||"Sin nombre"," "),c(2),f(e.user.email),c(3),g("ngIf",t.canManageUsers)}}function we(a,n){a&1&&(o(0,"div",37),_(1,"i",31),s(2," Procesando... "),i())}var N=class a{project;projectService=C(F);userService=C(z);authService=C(E);projectOwner=null;showAddUser=!1;searchEmail="";searchResults=[];isSearching=!1;isLoading=!1;searchSubject=new Y;get canManageUsers(){return this.authService.getCurrentUser()?.id===this.project?.userId}ngOnInit(){this.loadProjectOwner(),this.setupSearch()}loadProjectOwner(){this.project?.userId&&this.userService.getUser(this.project.userId).subscribe({next:n=>{this.projectOwner=n},error:n=>{console.error("Error loading project owner:",n)}})}setupSearch(){this.searchSubject.pipe(X(300),Z(),$(n=>!n||n.length<2?A([]):(this.isSearching=!0,this.userService.searchUsersByEmail(n).pipe(J(e=>(console.error("Error searching users:",e),A([]))))))).subscribe({next:n=>{this.searchResults=n.filter(e=>e.id!==this.project?.userId&&!this.project?.sharedUsers?.some(t=>t.id===e.id)),this.isSearching=!1},error:()=>{this.isSearching=!1}})}onSearchInput(n){let e=n.target.value;this.searchSubject.next(e)}clearSearch(){this.searchEmail="",this.searchResults=[]}selectUser(n){this.isLoading=!0,this.projectService.shareProject(this.project.id,{userId:n.id}).subscribe({next:e=>{this.project.sharedUsers||(this.project.sharedUsers=[]),this.project.sharedUsers.push(e),this.clearSearch(),this.showAddUser=!1,this.isLoading=!1,console.log("Usuario agregado exitosamente")},error:e=>{console.error("Error sharing project:",e),this.isLoading=!1,alert("Error al agregar usuario al proyecto")}})}removeUser(n){confirm("\xBFEst\xE1s seguro de que quieres remover este usuario del proyecto?")&&(this.isLoading=!0,this.projectService.removeSharedUser(this.project.id,n).subscribe({next:()=>{this.project.sharedUsers&&(this.project.sharedUsers=this.project.sharedUsers.filter(e=>e.id!==n)),this.isLoading=!1,console.log("Usuario removido exitosamente")},error:e=>{console.error("Error removing user:",e),this.isLoading=!1,alert("Error al remover usuario del proyecto")}}))}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-project-users"]],inputs:{project:"project"},decls:19,vars:8,consts:[[1,"project-users"],[1,"users-header"],["class","btn btn-primary btn-sm",3,"click",4,"ngIf"],["class","add-user-section",4,"ngIf"],[1,"users-list"],[1,"user-item","owner"],[1,"user-info"],[1,"user-avatar",3,"src","alt"],[1,"user-details"],[1,"user-name"],[1,"user-email"],[1,"badge","badge-primary"],["class","user-item",4,"ngFor","ngForOf"],["class","text-center py-3",4,"ngIf"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"fa","fa-plus"],[1,"add-user-section"],[1,"search-user"],[1,"input-group"],["type","email","placeholder","Buscar usuario por email...",1,"form-control",3,"ngModelChange","input","ngModel","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fa","fa-times"],["class","search-results",4,"ngIf"],["class","text-center py-2",4,"ngIf"],["class","text-muted text-center py-2",4,"ngIf"],[1,"search-results"],["class","search-result-item",3,"click",4,"ngFor","ngForOf"],[1,"search-result-item",3,"click"],[1,"user-avatar-sm",3,"src","alt"],[1,"btn","btn-sm","btn-success"],[1,"text-center","py-2"],[1,"fa","fa-spinner","fa-spin"],[1,"text-muted","text-center","py-2"],[1,"user-item"],[1,"badge","badge-secondary"],["class","btn btn-sm btn-outline-danger","title","Remover usuario",3,"click",4,"ngIf"],["title","Remover usuario",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"text-center","py-3"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),s(3,"Miembros del Proyecto"),i(),h(4,Pe,3,0,"button",2),i(),h(5,xe,9,5,"div",3),o(6,"div",4)(7,"div",5)(8,"div",6),_(9,"img",7),o(10,"div",8)(11,"div",9),s(12),i(),o(13,"div",10),s(14),i(),o(15,"span",11),s(16,"Propietario"),i()()()(),h(17,je,11,5,"div",12),i(),h(18,we,3,0,"div",13),i()),e&2&&(c(4),g("ngIf",t.canManageUsers),c(),g("ngIf",t.showAddUser),c(4),g("src",(t.projectOwner==null?null:t.projectOwner.avatar)||"default-avatar.png",j)("alt",(t.projectOwner==null?null:t.projectOwner.name)||(t.projectOwner==null?null:t.projectOwner.email)),c(3),k(" ",(t.projectOwner==null?null:t.projectOwner.name)||"Sin nombre"," "),c(2),f(t.projectOwner==null?null:t.projectOwner.email),c(3),g("ngForOf",t.project==null?null:t.project.sharedUsers),c(),g("ngIf",t.isLoading))},dependencies:[T,y,S,D,I,U,V],styles:[".project-users[_ngcontent-%COMP%]   .users-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid #e9ecef}.project-users[_ngcontent-%COMP%]   .users-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#495057;font-size:1.1rem;font-weight:600}.project-users[_ngcontent-%COMP%]   .users-header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .75rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #e9ecef;border-radius:.375rem;padding:1rem;margin-bottom:1rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]{position:relative}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{margin-bottom:.5rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;border:1px solid #e9ecef;border-radius:.375rem;background:#fff;box-shadow:0 2px 4px #0000001a}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;border-bottom:1px solid #f1f3f4;cursor:pointer;transition:background-color .15s ease}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-avatar-sm[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;margin-right:.75rem;object-fit:cover}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:500;color:#495057;font-size:.875rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{color:#6c757d;font-size:.75rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-user[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex-shrink:0}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;border:1px solid #e9ecef;border-radius:.375rem;margin-bottom:.5rem;background:#fff;transition:all .15s ease}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000000d}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item.owner[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e3f2fd,#f3e5f5);border-color:#bbdefb}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;margin-right:1rem;object-fit:cover;border:2px solid #fff;box-shadow:0 1px 3px #0000001a}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:500;color:#495057;margin-bottom:.25rem}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{color:#6c757d;font-size:.875rem;margin-bottom:.25rem}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.25rem .5rem}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .badge.badge-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .badge.badge-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.project-users[_ngcontent-%COMP%]   .users-list[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex-shrink:0;margin-left:.5rem}@media (max-width: 768px){.project-users[_ngcontent-%COMP%]   .users-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}.project-users[_ngcontent-%COMP%]   .users-header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{align-self:stretch}.project-users[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-avatar[_ngcontent-%COMP%]{width:32px;height:32px;margin-right:.75rem}.project-users[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-size:.875rem}.project-users[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-email[_ngcontent-%COMP%]{font-size:.75rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]{padding:.75rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{padding:.5rem}.project-users[_ngcontent-%COMP%]   .add-user-section[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-avatar-sm[_ngcontent-%COMP%]{width:28px;height:28px;margin-right:.5rem}}.project-users[_ngcontent-%COMP%]   .text-center.py-2[_ngcontent-%COMP%]{padding:.5rem 0}.project-users[_ngcontent-%COMP%]   .text-center.py-3[_ngcontent-%COMP%]{padding:1rem 0}.project-users[_ngcontent-%COMP%]   .text-center[_ngcontent-%COMP%]   .fa-spinner[_ngcontent-%COMP%]{color:#007bff}.project-users[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#6c757d!important}"]})};var ye=["membersOffcanvas"],Se=a=>[a];function Te(a,n){if(a&1&&(o(0,"app-page-header",3)(1,"nav",4)(2,"ol",5)(3,"li",6)(4,"a",7),s(5,"Proyectos"),i()(),o(6,"li",8),s(7),i()()()()),a&2){let e,t,r,l=d();g("title",((e=l.project())==null?null:e.name)||"Project")("subtitle",((t=l.project())==null?null:t.description)||"Project management board")("actions",l.headerActions),c(7),f((r=l.project())==null?null:r.name)}}function Ee(a,n){if(a&1&&(o(0,"option",31),s(1),i()),a&2){let e=n.$implicit;g("value",e.id),c(),f(e.name)}}function Ie(a,n){if(a&1){let e=P();o(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"div",13)(5,"label",14),s(6,"Asignado a"),i(),o(7,"select",15),v("ngModelChange",function(r){m(e);let l=d();return O(l.filters.assignee,r)||(l.filters.assignee=r),p(r)}),u("change",function(){m(e);let r=d();return p(r.applyFilters())}),o(8,"option",16),s(9,"Todos los Asignados"),i(),h(10,Ee,2,2,"option",17),i()(),o(11,"div",18)(12,"label",14),s(13,"Prioridad"),i(),o(14,"select",15),v("ngModelChange",function(r){m(e);let l=d();return O(l.filters.priority,r)||(l.filters.priority=r),p(r)}),u("change",function(){m(e);let r=d();return p(r.applyFilters())}),o(15,"option",16),s(16,"Todas las Prioridades"),i(),o(17,"option",19),s(18,"Alta"),i(),o(19,"option",20),s(20,"Media"),i(),o(21,"option",21),s(22,"Baja"),i()()(),o(23,"div",18)(24,"label",14),s(25,"Etiquetas"),i(),o(26,"select",15),v("ngModelChange",function(r){m(e);let l=d();return O(l.filters.label,r)||(l.filters.label=r),p(r)}),u("change",function(){m(e);let r=d();return p(r.applyFilters())}),o(27,"option",16),s(28,"Todas las Etiquetas"),i()()(),o(29,"div",18)(30,"label",14),s(31,"Fecha L\xEDmite"),i(),o(32,"select",15),v("ngModelChange",function(r){m(e);let l=d();return O(l.filters.dueDate,r)||(l.filters.dueDate=r),p(r)}),u("change",function(){m(e);let r=d();return p(r.applyFilters())}),o(33,"option",16),s(34,"Todas las Tareas"),i(),o(35,"option",22),s(36,"Vencidas"),i(),o(37,"option",23),s(38,"Vencen Hoy"),i(),o(39,"option",24),s(40,"Vencen Esta Semana"),i()()(),o(41,"div",13)(42,"label",14),s(43,"Buscar"),i(),o(44,"input",25),v("ngModelChange",function(r){m(e);let l=d();return O(l.filters.search,r)||(l.filters.search=r),p(r)}),u("keyup",function(){m(e);let r=d();return p(r.applyFilters())}),i()()(),o(45,"div",26)(46,"div",27)(47,"button",28),u("click",function(){m(e);let r=d();return p(r.clearFilters())}),_(48,"i",29),s(49,"Limpiar Todo "),i()(),o(50,"small",30),s(51),i()()()()()}if(a&2){let e=d();c(7),M("ngModel",e.filters.assignee),c(3),g("ngForOf",e.users()),c(4),M("ngModel",e.filters.priority),c(12),M("ngModel",e.filters.label),c(6),M("ngModel",e.filters.dueDate),c(12),M("ngModel",e.filters.search),c(7),ee("",e.getFilteredTasks().length," de ",e.tasks().length," tareas mostradas")}}function Ue(a,n){if(a&1){let e=P();o(0,"div",9)(1,"div",32),_(2,"i",33),s(3),o(4,"button",34),u("click",function(){m(e);let r=d();return p(r.loadProjectData(r.projectId()))}),_(5,"i",35),s(6,"Intentar de Nuevo "),i()()()}if(a&2){let e=d();c(3),k("",e.error()," ")}}function Ve(a,n){if(a&1){let e=P();o(0,"div",9)(1,"app-kanban-board",36),u("taskStatusChanged",function(r){m(e);let l=d();return p(l.onTaskStatusChanged(r))})("taskCreated",function(r){m(e);let l=d();return p(l.onTaskCreated(r))})("taskUpdated",function(r){m(e);let l=d();return p(l.onTaskUpdated(r))})("taskClicked",function(r){m(e);let l=d();return p(l.openTaskModal(r))}),i()()}if(a&2){let e=d();c(),g("tasks",e.getFilteredTasks())("projects",te(7,Se,e.project()))("users",e.users())("loading",e.loading())("showProject",!1)("allowCreateTask",!0)("currentProjectId",e.projectId())}}function De(a,n){if(a&1&&(o(0,"div",42)(1,"h6",63),s(2,"Descripci\xF3n"),i(),o(3,"p",30),s(4),i()()),a&2){let e,t=d(2);c(4),f((e=t.project())==null?null:e.description)}}function Fe(a,n){if(a&1){let e=P();o(0,"div",37)(1,"h4",38),s(2),i(),o(3,"button",39),u("click",function(){let r=m(e).$implicit;return p(r.dismiss())}),i()(),o(4,"div",40),h(5,De,5,1,"div",41),o(6,"div",42)(7,"h6",43),s(8,"Estad\xEDsticas del Proyecto"),i(),o(9,"div",44)(10,"div",45)(11,"div",46)(12,"div",47)(13,"div",48)(14,"span",49),s(15,"Total"),i(),o(16,"span",50),s(17),i()()()()(),o(18,"div",45)(19,"div",51)(20,"div",47)(21,"div",48)(22,"span",49),s(23,"Completadas"),i(),o(24,"span",52),s(25),i()()()()(),o(26,"div",45)(27,"div",53)(28,"div",47)(29,"div",48)(30,"span",49),s(31,"En progreso"),i(),o(32,"span",54),s(33),i()()()()(),o(34,"div",45)(35,"div",55)(36,"div",47)(37,"div",48)(38,"span",49),s(39,"Pendientes"),i(),o(40,"span",56),s(41),i()()()()()()(),o(42,"div",42),_(43,"app-project-users",57),i(),o(44,"div",58)(45,"h6",43),s(46,"Acciones"),i(),o(47,"div",59)(48,"button",28),u("click",function(){let r=m(e).$implicit;return d().openDocumentation(),p(r.dismiss())}),_(49,"i",60),s(50," Documentaci\xF3n "),i(),o(51,"button",61),u("click",function(){let r=m(e).$implicit;return p(r.dismiss())}),_(52,"i",62),s(53," Volver a Proyectos "),i()()()()}if(a&2){let e,t,r=d();c(2),f((e=r.project())==null?null:e.name),c(3),g("ngIf",(t=r.project())==null?null:t.description),c(12),f(r.tasks().length),c(8),f(r.completedTasksCount),c(8),f(r.inProgressTasksCount),c(8),f(r.pendingTasksCount),c(2),g("project",r.project())}}var ue=class a{kanbanBoard;membersOffcanvasTemplate;route=C(re);router=C(oe);projectService=C(F);taskService=C(le);userService=C(z);authService=C(E);modalService=C(me);offcanvasService=C(pe);project=b(null);projectId=b(0);loading=b(!0);error=b(null);tasks=b([]);users=b([]);showFilters=b(!1);filters={assignee:"",priority:"",label:"",dueDate:"",search:""};filteredTasks=[];headerActions=[{label:"Nueva Tarea",icon:"fas fa-plus",action:()=>this.createNewTask(),variant:"primary"},{label:"Documentaci\xF3n",icon:"fas fa-book",action:()=>this.openDocumentation(),variant:"outline"},{label:"Filtros",icon:"fas fa-filter",action:()=>this.toggleFilters(),variant:"outline"},{label:"Miembros",icon:"fas fa-users",action:()=>this.openMembersOffcanvas(),variant:"outline"}];ngOnInit(){let n=this.route.snapshot.params.id;if(n){let t=parseInt(n);this.projectId.set(t),this.loadProjectData(t)}let e=this.route.snapshot.params.taskId;e&&this.loadProjectData(parseInt(n)).then(()=>{this.openTaskModalById(parseInt(e))})}loadProjectData(n){return G(this,null,function*(){this.loading.set(!0),this.error.set(null);try{if(!this.authService.getCurrentUser()){this.error.set("Usuario no autenticado"),this.loading.set(!1);return}let[t,r]=yield Promise.all([this.projectService.getProject(n).toPromise(),this.taskService.getProjectTasks(n).toPromise()]);if(t)this.project.set(t);else{this.error.set("Proyecto no encontrado"),this.loading.set(!1);return}r&&(this.tasks.set(r),this.filteredTasks=r),this.loading.set(!1)}catch(e){console.error("Error loading project data:",e),this.error.set("Error al cargar el proyecto"),this.loading.set(!1)}})}openTaskModalById(n){let e=this.tasks().find(t=>t.id===n);e?this.openTaskModal(e):console.error("Task not found:",n)}openTaskModal(n){this.router.navigate(["/projects",this.projectId(),"tasks",n.id]);let e=this.modalService.open(ge,{size:"fullscreen",backdrop:"static",windowClass:"fullscreen-modal-window"});e.componentInstance.task=R({},n),e.componentInstance.projects=[this.project()],e.componentInstance.users=this.users(),e.result.then(t=>{t&&this.onTaskUpdated(t),this.router.navigate(["/projects",this.projectId()])}).catch(()=>{this.router.navigate(["/projects",this.projectId()])})}toggleFilters(){this.showFilters.set(!this.showFilters())}applyFilters(){let n=this.tasks();if(this.filters.assignee&&(n=n.filter(e=>e.assignedTo===this.filters.assignee)),this.filters.priority&&(n=n.filter(e=>e.priority===this.filters.priority)),this.filters.label&&(n=n.filter(e=>e.labels&&e.labels.some(t=>t.includes(this.filters.label)))),this.filters.search){let e=this.filters.search.toLowerCase();n=n.filter(t=>t.title.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e))}this.filteredTasks=n}clearFilters(){this.filters={assignee:"",priority:"",label:"",dueDate:"",search:""},this.applyFilters()}getFilteredTasks(){return this.filteredTasks}openDocumentation(){let n=this.projectId();n&&this.router.navigate(["/projects",n,"documentation"])}createNewTask(){this.kanbanBoard&&this.kanbanBoard.createTask()}onTaskCreated(n){this.loadProjectData(this.projectId())}onTaskUpdated(n){this.tasks.update(e=>e.map(t=>t.id===n.id?n:t)),this.applyFilters()}onTaskStatusChanged(n){let{task:e,newStatus:t,previousStatus:r}=n,l=this.authService.getCurrentUser();if(!l)return;let L=[...this.tasks()],Q=L.findIndex(x=>x.id===e.id);Q>-1&&(L[Q]=K(R({},e),{status:t}),this.tasks.set(L),this.applyFilters()),this.taskService.updateTaskStatus(e.id,{newStatus:t,userId:l.id}).subscribe({next:x=>{console.log("Task status updated successfully:",x)},error:x=>{console.error("Failed to update task status:",x),e.status=r,this.loadProjectData(this.projectId())}})}openMembersOffcanvas(){this.offcanvasService.open(this.membersOffcanvasTemplate,{position:"end",backdrop:!0,keyboard:!0,panelClass:"members-offcanvas"}).result.then(e=>{e&&(console.log("Members offcanvas result:",e),this.loadProjectData(this.projectId()))},e=>{console.log("Members offcanvas dismissed")})}getMembersCount(){let n=this.project();if(!n)return 0;let e=1;return n.sharedUsers&&(e+=n.sharedUsers.length),e}shareProject(){this.openMembersOffcanvas()}get completedTasksCount(){return this.tasks().filter(n=>n.status==="FINISHED").length}get inProgressTasksCount(){return this.tasks().filter(n=>n.status==="IN_PROGRESS"||n.status==="TESTING"||n.status==="READY_TO_FINISH").length}get pendingTasksCount(){return this.tasks().filter(n=>n.status==="CREATED"||n.status==="BLOCKED").length}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-project-detail"]],viewQuery:function(e,t){if(e&1&&(B(H,5),B(ye,5)),e&2){let r;W(r=q())&&(t.kanbanBoard=r.first),W(r=q())&&(t.membersOffcanvasTemplate=r.first)}},decls:6,vars:4,consts:[["membersOffcanvas",""],[3,"title","subtitle","actions",4,"ngIf"],["class","container-fluid px-4",4,"ngIf"],[3,"title","subtitle","actions"],["aria-label","breadcrumb",1,"mb-3"],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],["routerLink","/projects",1,"text-decoration-none"],[1,"breadcrumb-item","active"],[1,"container-fluid","px-4"],[1,"card","card-notion","mb-3"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-3"],[1,"form-label","small","fw-medium"],[1,"form-select","form-select-sm",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-2"],["value","high"],["value","medium"],["value","low"],["value","overdue"],["value","today"],["value","week"],["type","text","placeholder","Buscar tareas...",1,"form-control","form-control-sm",3,"ngModelChange","keyup","ngModel"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"fas","fa-times","me-1"],[1,"text-muted"],[3,"value"],["role","alert",1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"btn","btn-outline-danger","btn-sm","ms-3",3,"click"],[1,"fas","fa-redo","me-1"],[3,"taskStatusChanged","taskCreated","taskUpdated","taskClicked","tasks","projects","users","loading","showProject","allowCreateTask","currentProjectId"],[1,"offcanvas-header"],[1,"offcanvas-title"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"offcanvas-body"],["class","mb-4",4,"ngIf"],[1,"mb-4"],[1,"fw-bold","mb-3"],[1,"row","g-2"],[1,"col-6"],[1,"card","bg-light"],[1,"card-body","py-2","px-3"],[1,"d-flex","justify-content-between"],[1,"small","text-muted"],[1,"fw-bold"],[1,"card","bg-success","bg-opacity-10"],[1,"fw-bold","text-success"],[1,"card","bg-warning","bg-opacity-10"],[1,"fw-bold","text-warning"],[1,"card","bg-info","bg-opacity-10"],[1,"fw-bold","text-info"],[3,"project"],[1,"mb-3"],[1,"d-grid","gap-2"],[1,"fas","fa-book","me-1"],["routerLink","/projects",1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"fas","fa-arrow-left","me-1"],[1,"fw-bold","mb-2"]],template:function(e,t){e&1&&h(0,Te,8,4,"app-page-header",1)(1,Ie,52,8,"div",2)(2,Ue,7,1,"div",2)(3,Ve,2,9,"div",2)(4,Fe,54,7,"ng-template",null,0,ne),e&2&&(g("ngIf",t.project()&&!t.loading()&&!t.error()),c(),g("ngIf",t.showFilters()&&t.project()&&!t.error()),c(),g("ngIf",t.error()&&!t.loading()),c(),g("ngIf",t.project()&&!t.error()))},dependencies:[T,y,S,D,ae,ce,I,se,U,V,ie,de,H,N],styles:['.board-container[_ngcontent-%COMP%]{background:#fafafa;padding:1rem}.board-stats[_ngcontent-%COMP%]{display:flex;gap:2rem;flex-wrap:wrap}.board-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.board-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-weight:600;color:#1a1a1a;margin-right:.25rem}.kanban-board[_ngcontent-%COMP%]{display:flex;gap:1rem;overflow-x:auto;padding-bottom:1rem;min-height:70vh}.kanban-column[_ngcontent-%COMP%]{flex:1;min-width:280px;background:#fff;border-radius:8px;border:1px solid #e5e5e5;display:flex;flex-direction:column}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]{padding:1rem 1rem .5rem;border-bottom:1px solid #f0f0f0}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .column-title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .column-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#1a1a1a;margin:0;text-transform:uppercase;letter-spacing:.05em}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .column-title[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#f5f5f5;color:#666;font-size:.75rem;font-weight:500;padding:.25rem .5rem;border-radius:12px;min-width:1.5rem;text-align:center}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .add-task-btn[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px dashed #d0d0d0;background:transparent;color:#666;border-radius:4px;font-size:.75rem;cursor:pointer;transition:all .2s ease}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .add-task-btn[_ngcontent-%COMP%]:hover{border-color:#a0a0a0;color:#1a1a1a;background:#f9f9f9}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .add-task-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}.kanban-column[_ngcontent-%COMP%]   .column-content[_ngcontent-%COMP%]{flex:1;padding:.5rem;min-height:200px}.kanban-column.column-created[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#f0f0f0}.kanban-column.column-progress[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.kanban-column.column-blocked[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.kanban-column.column-testing[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#fff3e0;color:#ef6c00}.kanban-column.column-ready[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#e0f2f1;color:#00695c}.kanban-column.column-finished[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#e8f5e8;color:#2e7d32}.task-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e8e8e8;border-radius:6px;padding:.75rem;margin-bottom:.5rem;cursor:pointer;transition:all .2s ease;position:relative}.task-card[_ngcontent-%COMP%]:hover{border-color:#d0d0d0;box-shadow:0 2px 8px #0000001a}.task-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.task-card[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#1a1a1a;line-height:1.4;margin-bottom:.5rem}.task-card[_ngcontent-%COMP%]   .task-description[_ngcontent-%COMP%]{font-size:.8rem;color:#666;line-height:1.4;margin-bottom:.75rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]   .task-labels[_ngcontent-%COMP%]{display:flex;gap:.25rem;flex:1}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]   .task-labels[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{background:#f5f5f5;color:#666;font-size:.7rem;padding:.125rem .375rem;border-radius:3px;font-weight:500}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]   .task-assignee[_ngcontent-%COMP%]{width:24px;height:24px;background:#e0e0e0;color:#666;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:600;text-transform:uppercase}.task-card[_ngcontent-%COMP%]   .task-priority[_ngcontent-%COMP%]{position:absolute;top:.75rem;right:.75rem;width:6px;height:6px;border-radius:50%}.task-card[_ngcontent-%COMP%]   .task-priority.priority-high[_ngcontent-%COMP%]{background:#f44336}.task-card[_ngcontent-%COMP%]   .task-priority.priority-medium[_ngcontent-%COMP%]{background:#ff9800}.task-card[_ngcontent-%COMP%]   .task-priority.priority-low[_ngcontent-%COMP%]{background:#4caf50}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:6px;box-shadow:0 8px 24px #0003;transform:rotate(3deg);background:#fff;border:1px solid #d0d0d0}.cdk-drag-preview[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]{color:#1a1a1a!important}.cdk-drag-preview[_ngcontent-%COMP%]   .task-description[_ngcontent-%COMP%]{color:#666!important}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3;border:2px dashed #a0a0a0;background:linear-gradient(45deg,#f0f0f0 25%,transparent 25%,transparent 75%,#f0f0f0 75%,#f0f0f0),linear-gradient(45deg,#f0f0f0 25%,transparent 25%,transparent 75%,#f0f0f0 75%,#f0f0f0);background-size:8px 8px;background-position:0 0,4px 4px;border-radius:6px;min-height:60px;display:flex;align-items:center;justify-content:center}.cdk-drag-placeholder[_ngcontent-%COMP%]:before{content:"Drop here";color:#999;font-size:.75rem;font-weight:500}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .3s cubic-bezier(.4,0,.2,1)}.cdk-drop-list[_ngcontent-%COMP%]{min-height:100px;transition:background-color .25s ease;border-radius:4px}.cdk-drop-list.cdk-drop-list-receiving[_ngcontent-%COMP%]{background-color:#6366f10d;border:2px dashed rgba(99,102,241,.3)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .3s cubic-bezier(.4,0,.2,1)}.cdk-drag[_ngcontent-%COMP%]{cursor:grab}.cdk-drag[_ngcontent-%COMP%]:active{cursor:grabbing}.cdk-drag.cdk-drag-disabled[_ngcontent-%COMP%]{cursor:default;opacity:.6}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem;color:#999}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;margin:0}@media (max-width: 1024px){.kanban-board[_ngcontent-%COMP%]{gap:.75rem}.kanban-column[_ngcontent-%COMP%]{min-width:250px}}.project-sidebar[_ngcontent-%COMP%]   .sidebar-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.project-sidebar[_ngcontent-%COMP%]   .sidebar-section[_ngcontent-%COMP%]:last-child{margin-bottom:0}.project-sidebar[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border:1px solid #e9ecef;border-radius:.5rem;box-shadow:0 1px 3px #0000001a}.project-sidebar[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #e9ecef;padding:.75rem 1rem}.project-sidebar[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{color:#495057;font-weight:600;font-size:.9rem}.project-sidebar[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1rem}.project-sidebar[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;border-bottom:1px solid #f1f3f4}.project-sidebar[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]:last-child{border-bottom:none;padding-bottom:0}.project-sidebar[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{color:#6c757d;font-size:.875rem}.project-sidebar[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem}@media (max-width: 1199px){.project-sidebar[_ngcontent-%COMP%]{margin-top:2rem}}@media (max-width: 768px){.board-container[_ngcontent-%COMP%]{padding:1rem .5rem}.kanban-board[_ngcontent-%COMP%]{gap:.5rem}.kanban-column[_ngcontent-%COMP%]{min-width:220px}.board-header[_ngcontent-%COMP%]   .board-stats[_ngcontent-%COMP%]{flex-wrap:wrap;gap:1rem}.project-sidebar[_ngcontent-%COMP%]{margin-top:1rem}.project-sidebar[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{margin-bottom:1rem}}[_nghost-%COMP%]     .members-offcanvas{width:400px;max-width:90vw}[_nghost-%COMP%]     .members-offcanvas .offcanvas-header{border-bottom:1px solid #dee2e6;background-color:#f8f9fa}[_nghost-%COMP%]     .members-offcanvas .offcanvas-header .offcanvas-title{font-weight:600;color:#495057}[_nghost-%COMP%]     .members-offcanvas .offcanvas-header .btn-close{margin:0}[_nghost-%COMP%]     .members-offcanvas .offcanvas-body{padding:1.5rem;overflow-y:auto}@media (max-width: 768px){[_nghost-%COMP%]     .members-offcanvas{width:320px}[_nghost-%COMP%]     .members-offcanvas .offcanvas-body{padding:1rem}}@media (max-width: 576px){[_nghost-%COMP%]     .members-offcanvas{width:100vw;max-width:100vw}}']})};export{ue as ProjectDetailComponent};
