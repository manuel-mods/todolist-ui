import{a as re}from"./chunk-IRWHQV2Y.js";import{a as ne}from"./chunk-ITIMRF4J.js";import{a as ie,b as ae}from"./chunk-OFQQDMTS.js";import{a as B}from"./chunk-SVIYRKC5.js";import{a as te}from"./chunk-P2AP2LDR.js";import{b as F,c as T,d as H,e as V,g as A,h as J,i as N,j,k as Q,l as X,m as Z,n as ee,o as G,p as U,q as z}from"./chunk-B6CTW34R.js";import{r as D}from"./chunk-UEBHN7X3.js";import{Ab as K,Bc as Y,Cb as a,Cc as P,Db as i,Dc as w,Eb as u,Fb as I,Gb as f,Gc as W,Ha as b,Hb as c,Ic as O,Qb as o,Rb as C,Sb as x,a as S,ac as q,b as E,bb as R,cb as s,cc as L,ma as k,mb as M,qb as g,ua as _,va as v,xb as m,zb as y}from"./chunk-HT5E4KE5.js";function ce(r,e){r&1&&(a(0,"div",19),o(1," El comentario no puede estar vac\xEDo "),i())}function pe(r,e){r&1&&u(0,"span",20)}function ue(r,e){r&1&&u(0,"i",21)}function ge(r,e){if(r&1){let t=I();a(0,"div",7)(1,"form",8),f("ngSubmit",function(){_(t);let l=c();return v(l.addComment())}),a(2,"div",9)(3,"div",10)(4,"div",11),o(5),i()(),a(6,"div",12)(7,"textarea",13),o(8,"              "),i(),g(9,ce,2,0,"div",14),a(10,"div",15)(11,"button",16),g(12,pe,1,0,"span",17)(13,ue,1,0,"i",18),o(14),i()()()()()()}if(r&2){let t,n,l=c();s(),m("formGroup",l.commentForm),s(4),x(" ",l.getCurrentUserInitials()," "),s(2),y("is-invalid",((t=l.commentForm.get("comment"))==null?null:t.invalid)&&((t=l.commentForm.get("comment"))==null?null:t.touched)),s(2),m("ngIf",((n=l.commentForm.get("comment"))==null?null:n.invalid)&&((n=l.commentForm.get("comment"))==null?null:n.touched)),s(2),m("disabled",l.commentForm.invalid||l.adding()),s(),m("ngIf",l.adding()),s(),m("ngIf",!l.adding()),s(),x(" ",l.adding()?"Agregando...":"Agregar Comentario"," ")}}function fe(r,e){if(r&1&&(a(0,"div",37),o(1),i()),r&2){let t=c(2).$implicit;s(),x(" ",t.content," ")}}function _e(r,e){if(r&1){let t=I();a(0,"form",8),f("ngSubmit",function(){_(t);let l=c(2).$implicit,d=c();return v(d.saveEditComment(l))}),a(1,"textarea",38),o(2,"                "),i(),a(3,"div",39)(4,"button",16),u(5,"i",40),o(6,"Guardar "),i(),a(7,"button",41),f("click",function(){_(t);let l=c(3);return v(l.cancelEditComment())}),o(8," Cancelar "),i()()()}if(r&2){let t=c(3);m("formGroup",t.editCommentForm),s(4),m("disabled",t.editCommentForm.invalid)}}function ve(r,e){if(r&1){let t=I();a(0,"div",42)(1,"button",43),f("click",function(){_(t);let l=c(2).$implicit,d=c();return v(d.startEditComment(l))}),u(2,"i",44),o(3,"Editar "),i(),a(4,"button",45),f("click",function(){_(t);let l=c(2).$implicit,d=c();return v(d.deleteComment(l))}),u(5,"i",46),o(6,"Eliminar "),i()()}}function he(r,e){if(r&1&&(a(0,"div",33),g(1,fe,2,1,"div",34)(2,_e,9,2,"form",35)(3,ve,7,0,"div",36),i()),r&2){let t=c().$implicit,n=c();s(),m("ngIf",!n.isEditingComment(t.id)),s(),m("ngIf",n.isEditingComment(t.id)),s(),m("ngIf",n.canEditComment(t)&&!n.isEditingComment(t.id))}}function be(r,e){if(r&1&&(a(0,"span",51),o(1),i()),r&2){let t=c(2).$implicit;s(),C(t.oldValue)}}function xe(r,e){r&1&&u(0,"i",52)}function Ce(r,e){if(r&1&&(a(0,"span",53),o(1),i()),r&2){let t=c(2).$implicit;s(),C(t.newValue)}}function ke(r,e){if(r&1&&(a(0,"div",33)(1,"div",47),g(2,be,2,1,"span",48)(3,xe,1,0,"i",49)(4,Ce,2,1,"span",50),i()()),r&2){let t=c().$implicit;s(2),m("ngIf",t.oldValue),s(),m("ngIf",t.oldValue&&t.newValue),s(),m("ngIf",t.newValue)}}function ye(r,e){if(r&1&&(a(0,"div",22)(1,"div",23),u(2,"i"),i(),a(3,"div",24)(4,"div",25)(5,"div",26)(6,"div",27),o(7),i(),a(8,"div",28)(9,"span",29),o(10),i(),a(11,"span",30),o(12),i()()(),a(13,"div",31),o(14),i()(),g(15,he,4,3,"div",32)(16,ke,5,3,"div",32),i()()),r&2){let t=e.$implicit,n=c();s(),m("ngClass",n.getTimelineMarkerClass(t.type)),s(),K(n.getTimelineIcon(t.type)),s(5),x(" ",n.getUserInitials(t.user)," "),s(3),C(t.user.name),s(2),C(n.getActionDescription(t)),s(2),x(" ",n.formatTimestamp(t.createdAt)," "),s(),m("ngIf",t.type==="comment"&&t.content),s(),m("ngIf",t.type!=="comment")}}function Te(r,e){r&1&&(a(0,"div",54),u(1,"i",55),a(2,"p",56),o(3,"A\xFAn no hay actividad"),i(),a(4,"small",57),o(5,"Los comentarios y cambios aparecer\xE1n aqu\xED"),i()())}function Ie(r,e){r&1&&(a(0,"div",58)(1,"div",59)(2,"span",60),o(3,"Cargando..."),i()(),a(4,"p",56),o(5,"Cargando historial..."),i()())}function Se(r,e){if(r&1&&(a(0,"div",61),u(1,"i",62),o(2),i()),r&2){let t=c();s(2),x("",t.error()," ")}}var $=class r{taskId;allowComments=!0;initialHistory=[];taskService=k(B);authService=k(D);fb=k(G);historyItems=b([]);loading=b(!1);adding=b(!1);error=b(null);editingCommentId=b(null);commentForm=this.fb.group({comment:["",[T.required,T.minLength(1)]]});editCommentForm=this.fb.group({editText:["",[T.required,T.minLength(1)]]});ngOnInit(){this.initialHistory.length>0?this.historyItems.set(this.initialHistory):this.loadHistory()}loadHistory(){if(!this.taskId){this.loading.set(!1);return}this.loading.set(!0),this.error.set(null),this.taskService.getTaskComments(this.taskId).subscribe({next:e=>{let t=e.map(n=>({id:n.id,taskId:n.taskId,type:this.mapChangeTypeToHistoryType(n.changeType),content:n.comment||n.newValue,oldValue:n.oldValue,newValue:n.newValue,createdAt:new Date(n.createdAt),user:n.user||{id:n.changedBy,email:n.changedBy,name:n.changedBy}}));t.sort((n,l)=>new Date(l.createdAt).getTime()-new Date(n.createdAt).getTime()),this.historyItems.set(t),this.loading.set(!1)},error:e=>{console.error("Error loading task history:",e),this.error.set("Error al cargar el historial de la tarea"),this.loading.set(!1)}})}mapChangeTypeToHistoryType(e){switch(e.toUpperCase()){case"COMMENT":return"comment";case"STATUS_CHANGE":return"status_change";case"ASSIGNMENT":return"assignment";case"PRIORITY_CHANGE":return"priority_change";case"DUE_DATE_CHANGE":return"due_date_change";case"DESCRIPTION_CHANGE":return"description_change";default:return"comment"}}addComment(){if(this.commentForm.invalid){this.commentForm.markAllAsTouched();return}let e=this.authService.getCurrentUser();if(!e){this.error.set("Debes estar autenticado para agregar comentarios");return}this.adding.set(!0),this.error.set(null);let t=this.commentForm.value.comment;this.taskService.addComment(this.taskId,{comment:t,userId:e.id}).subscribe({next:n=>{let l={id:n.id,taskId:this.taskId,type:"comment",content:t,createdAt:new Date(n.createdAt),user:n.user||e};this.historyItems.update(d=>[l,...d]),this.commentForm.reset(),this.adding.set(!1)},error:n=>{console.error("Error adding comment:",n),this.error.set("Error al agregar el comentario"),this.adding.set(!1)}})}trackByHistoryId(e,t){return t.id}getCurrentUserInitials(){let e=this.authService.getCurrentUser();return this.getUserInitials(e)}getUserInitials(e){return!e||!e.name?"U":e.name.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2)}getTimelineMarkerClass(e){switch(e){case"comment":return"marker-comment";case"status_change":return"marker-status";case"assignment":return"marker-assignment";default:return"marker-change"}}getTimelineIcon(e){switch(e){case"comment":return"fas fa-comment";case"status_change":return"fas fa-exchange-alt";case"assignment":return"fas fa-user";case"priority_change":return"fas fa-exclamation";case"due_date_change":return"fas fa-calendar";case"description_change":return"fas fa-edit";default:return"fas fa-circle"}}getActionDescription(e){switch(e.type){case"comment":return"coment\xF3";case"status_change":return"cambi\xF3 el estado";case"assignment":return"asign\xF3 la tarea";case"priority_change":return"cambi\xF3 la prioridad";case"due_date_change":return"actualiz\xF3 la fecha l\xEDmite";case"description_change":return"actualiz\xF3 la descripci\xF3n";default:return"realiz\xF3 un cambio"}}formatTimestamp(e){let n=new Date().getTime()-new Date(e).getTime(),l=Math.floor(n/6e4),d=Math.floor(l/60),h=Math.floor(d/24);return l<1?"ahora mismo":l<60?`hace ${l}m`:d<24?`hace ${d}h`:h<7?`hace ${h}d`:new Date(e).toLocaleDateString("es-ES")}isEditingComment(e){return this.editingCommentId()===e}canEditComment(e){let t=this.authService.getCurrentUser();return e.type==="comment"&&t?.id===e.user.id}startEditComment(e){this.editingCommentId.set(e.id),this.editCommentForm.patchValue({editText:e.content||""})}cancelEditComment(){this.editingCommentId.set(null),this.editCommentForm.reset()}saveEditComment(e){if(this.editCommentForm.invalid){this.editCommentForm.markAllAsTouched();return}let t=this.editCommentForm.value.editText;this.taskService.updateComment(this.taskId,e.id,{comment:t}).subscribe({next:n=>{this.historyItems.update(l=>l.map(d=>d.id===e.id?E(S({},d),{content:t}):d)),this.editingCommentId.set(null),this.editCommentForm.reset()},error:n=>{console.error("Error updating comment:",n),this.error.set("Error al actualizar el comentario")}})}deleteComment(e){confirm("\xBFEst\xE1s seguro de que quieres eliminar este comentario?")&&this.taskService.deleteComment(this.taskId,e.id).subscribe({next:()=>{this.historyItems.update(n=>n.filter(l=>l.id!==e.id))},error:n=>{console.error("Error deleting comment:",n),this.error.set("Error al eliminar el comentario")}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-task-history"]],inputs:{taskId:"taskId",allowComments:"allowComments",initialHistory:"initialHistory"},decls:7,vars:6,consts:[[1,"task-history"],["class","add-comment-section mb-4",4,"ngIf"],[1,"history-timeline"],["class","timeline-item",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state text-center py-4",4,"ngIf"],["class","text-center py-4",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"add-comment-section","mb-4"],[3,"ngSubmit","formGroup"],[1,"d-flex","gap-3"],[1,"user-avatar"],[1,"avatar-circle"],[1,"flex-grow-1"],["formControlName","comment","placeholder","Agregar un comentario...","rows","3",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[1,"d-flex","justify-content-end","mt-2"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],["class","fas fa-comment me-1",4,"ngIf"],[1,"invalid-feedback"],[1,"spinner-border","spinner-border-sm","me-1"],[1,"fas","fa-comment","me-1"],[1,"timeline-item"],[1,"timeline-marker",3,"ngClass"],[1,"timeline-content"],[1,"timeline-header"],[1,"d-flex","align-items-center","gap-2"],[1,"user-avatar-small"],[1,"timeline-meta"],[1,"user-name"],[1,"action-description"],[1,"timeline-timestamp"],["class","timeline-body",4,"ngIf"],[1,"timeline-body"],["class","comment-content",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],["class","comment-actions mt-2",4,"ngIf"],[1,"comment-content"],["formControlName","editText","rows","3",1,"form-control","mb-2"],[1,"d-flex","gap-2"],[1,"fas","fa-save","me-1"],["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],[1,"comment-actions","mt-2"],["type","button",1,"btn","btn-link","btn-sm","p-0","me-2",3,"click"],[1,"fas","fa-edit","me-1"],["type","button",1,"btn","btn-link","btn-sm","p-0","text-danger",3,"click"],[1,"fas","fa-trash","me-1"],[1,"change-content"],["class","change-from",4,"ngIf"],["class","fas fa-arrow-right mx-2",4,"ngIf"],["class","change-to",4,"ngIf"],[1,"change-from"],[1,"fas","fa-arrow-right","mx-2"],[1,"change-to"],[1,"empty-state","text-center","py-4"],[1,"fas","fa-history","fa-2x","text-muted","mb-2"],[1,"text-muted","mb-0"],[1,"text-muted"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary","mb-2"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle","me-2"]],template:function(t,n){t&1&&(a(0,"div",0),g(1,ge,15,9,"div",1),a(2,"div",2),g(3,ye,17,9,"div",3)(4,Te,6,0,"div",4),i(),g(5,Ie,6,0,"div",5)(6,Se,3,1,"div",6),i()),t&2&&(s(),m("ngIf",n.allowComments),s(2),m("ngForOf",n.historyItems())("ngForTrackBy",n.trackByHistoryId),s(),m("ngIf",n.historyItems().length===0),s(),m("ngIf",n.loading()),s(),m("ngIf",n.error()))},dependencies:[O,Y,P,w,U,A,F,H,V,z,N,j],styles:['.task-history[_ngcontent-%COMP%]{max-height:500px;overflow-y:auto}.add-comment-section[_ngcontent-%COMP%]{border-bottom:1px solid var(--gray-200);padding-bottom:1rem}.user-avatar[_ngcontent-%COMP%]   .avatar-circle[_ngcontent-%COMP%]{width:40px;height:40px;background:var(--primary-100);color:var(--primary-700);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600;text-transform:uppercase}.user-avatar-small[_ngcontent-%COMP%]{width:28px;height:28px;background:var(--gray-100);color:var(--gray-700);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:600;text-transform:uppercase;flex-shrink:0}.history-timeline[_ngcontent-%COMP%]{position:relative}.history-timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;left:14px;top:0;bottom:0;width:2px;background:var(--gray-200)}.timeline-item[_ngcontent-%COMP%]{position:relative;padding-left:3rem;padding-bottom:1.5rem}.timeline-item[_ngcontent-%COMP%]:last-child{padding-bottom:0}.timeline-marker[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;background:#fff;border:2px solid var(--gray-300);z-index:1}.timeline-marker.marker-comment[_ngcontent-%COMP%]{border-color:var(--primary-500);background:var(--primary-50);color:var(--primary-600)}.timeline-marker.marker-status[_ngcontent-%COMP%]{border-color:var(--success-500);background:var(--success-50);color:var(--success-600)}.timeline-marker.marker-assignment[_ngcontent-%COMP%]{border-color:var(--warning-500);background:var(--warning-50);color:var(--warning-600)}.timeline-marker.marker-change[_ngcontent-%COMP%]{border-color:var(--gray-400);background:var(--gray-50);color:var(--gray-600)}.timeline-content[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:1rem;box-shadow:var(--shadow-xs)}.timeline-header[_ngcontent-%COMP%]{display:flex;justify-content:between;align-items:flex-start;gap:1rem;margin-bottom:.75rem}.timeline-header[_ngcontent-%COMP%]   .timeline-meta[_ngcontent-%COMP%]{flex:1}.timeline-header[_ngcontent-%COMP%]   .timeline-meta[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:600;color:var(--gray-900);margin-right:.5rem}.timeline-header[_ngcontent-%COMP%]   .timeline-meta[_ngcontent-%COMP%]   .action-description[_ngcontent-%COMP%]{color:var(--gray-600);font-size:.875rem}.timeline-header[_ngcontent-%COMP%]   .timeline-timestamp[_ngcontent-%COMP%]{font-size:.75rem;color:var(--gray-500);white-space:nowrap}.timeline-body[_ngcontent-%COMP%]   .comment-content[_ngcontent-%COMP%]{color:var(--gray-800);line-height:1.5;white-space:pre-wrap}.timeline-body[_ngcontent-%COMP%]   .change-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem}.timeline-body[_ngcontent-%COMP%]   .change-content[_ngcontent-%COMP%]   .change-from[_ngcontent-%COMP%]{background:var(--error-50);color:var(--error-700);padding:.25rem .5rem;border-radius:var(--radius-sm);text-decoration:line-through}.timeline-body[_ngcontent-%COMP%]   .change-content[_ngcontent-%COMP%]   .change-to[_ngcontent-%COMP%]{background:var(--success-50);color:var(--success-700);padding:.25rem .5rem;border-radius:var(--radius-sm)}.timeline-body[_ngcontent-%COMP%]   .change-content[_ngcontent-%COMP%]   .fa-arrow-right[_ngcontent-%COMP%]{color:var(--gray-400)}.empty-state[_ngcontent-%COMP%]{padding:2rem 1rem}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:.5}.comment-actions[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]{color:var(--gray-500);text-decoration:none;font-size:.75rem}.comment-actions[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:hover{color:var(--primary-600);text-decoration:none}.comment-actions[_ngcontent-%COMP%]   .btn-link.text-danger[_ngcontent-%COMP%]:hover{color:var(--error-600)}@media (max-width: 768px){.timeline-header[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem;align-items:stretch}.timeline-header[_ngcontent-%COMP%]   .timeline-timestamp[_ngcontent-%COMP%]{align-self:flex-end}}']})};function Ee(r,e){if(r&1&&(a(0,"h3",17),o(1),i()),r&2){let t,n=c();s(),C((t=n.taskSignal())==null?null:t.title)}}function Me(r,e){r&1&&(a(0,"h3",17),o(1,"Nueva Tarea"),i())}function Pe(r,e){if(r&1&&(a(0,"small",18),o(1),i()),r&2){let t,n=c();s(),C((t=n.getSelectedProject())==null?null:t.name)}}function we(r,e){r&1&&u(0,"span",19)}function Oe(r,e){r&1&&u(0,"i",20)}function De(r,e){r&1&&(a(0,"div",21)(1,"div",22)(2,"div",23)(3,"span",24),o(4,"Cargando..."),i()(),a(5,"p",25),o(6,"Cargando detalles de la tarea..."),i()()())}function Fe(r,e){if(r&1&&(a(0,"div",26),u(1,"i",27),o(2),i()),r&2){let t=c();s(2),x("",t.error()," ")}}function He(r,e){r&1&&(a(0,"div",89),o(1," El t\xEDtulo es requerido "),i())}function Ve(r,e){if(r&1&&(a(0,"option",90),o(1),i()),r&2){let t=e.$implicit;m("value",t.id),s(),C(t.name)}}function Ae(r,e){r&1&&(a(0,"div",89),o(1," El proyecto es requerido "),i())}function Ne(r,e){if(r&1&&(a(0,"option",90),o(1),i()),r&2){let t=e.$implicit;m("value",t.id),s(),x(" ",t.title," ")}}function je(r,e){r&1&&u(0,"span",91)}function Ge(r,e){r&1&&u(0,"i",92)}function Ue(r,e){if(r&1){let t=I();a(0,"button",93),f("click",function(){_(t);let l=c(2);return v(l.deleteTask())}),u(1,"i",94),o(2,"Eliminar Tarea "),i()}}function ze(r,e){if(r&1&&(a(0,"div",95)(1,"div",96)(2,"span",97),o(3,"ID:"),i(),a(4,"span",98),o(5),i()(),a(6,"div",96)(7,"span",97),o(8,"Creada:"),i(),a(9,"span",98),o(10),q(11,"date"),i()(),a(12,"div",96)(13,"span",97),o(14,"Actualizada:"),i(),a(15,"span",98),o(16),q(17,"date"),i()()()),r&2){let t,n,l,d=c(2);s(5),x("#",(t=d.taskSignal())==null?null:t.id,""),s(5),C(L(11,3,(n=d.taskSignal())==null?null:n.createdAt,"dd/MM/yyyy")),s(6),C(L(17,6,(l=d.taskSignal())==null?null:l.updatedAt,"dd/MM/yyyy HH:mm"))}}function Be(r,e){if(r&1){let t=I();a(0,"div",28)(1,"div",29)(2,"div",30)(3,"button",31),f("click",function(){_(t);let l=c();return v(l.setActiveTab("general"))}),u(4,"i",32),o(5,"Informaci\xF3n General "),i(),a(6,"button",31),f("click",function(){_(t);let l=c();return v(l.setActiveTab("attachments"))}),u(7,"i",33),o(8,"Archivos "),i(),a(9,"button",31),f("click",function(){_(t);let l=c();return v(l.setActiveTab("activity"))}),u(10,"i",34),o(11,"Actividad "),i()(),a(12,"div",35)(13,"div",36)(14,"form",37)(15,"div",38)(16,"div",39)(17,"label",40),o(18,"T\xEDtulo *"),i(),u(19,"input",41),g(20,He,2,0,"div",42),i(),a(21,"div",39)(22,"label",43),o(23,"Descripci\xF3n"),i(),u(24,"textarea",44),i(),a(25,"div",45)(26,"div",46)(27,"div",39)(28,"label",47),o(29,"Proyecto *"),i(),a(30,"select",48),f("change",function(){_(t);let l=c();return v(l.onProjectChange())}),a(31,"option",49),o(32,"Selecciona un proyecto"),i(),g(33,Ve,2,2,"option",50),i(),g(34,Ae,2,0,"div",42),i()(),a(35,"div",46)(36,"div",39)(37,"label",51),o(38,"Estado"),i(),a(39,"select",52)(40,"option",53),o(41,"\u{1F195} Creada"),i(),a(42,"option",54),o(43,"\u{1F504} En Progreso"),i(),a(44,"option",55),o(45,"\u{1F6AB} Bloqueada"),i(),a(46,"option",56),o(47,"\u{1F9EA} En Pruebas"),i(),a(48,"option",57),o(49,"\u2705 Lista para Terminar"),i(),a(50,"option",58),o(51,"\u2728 Terminada"),i()()()()(),a(52,"div",45)(53,"div",46)(54,"div",39)(55,"label",59),o(56,"Prioridad"),i(),a(57,"select",60)(58,"option",61),o(59,"\u{1F7E2} Baja"),i(),a(60,"option",62),o(61,"\u{1F7E1} Media"),i(),a(62,"option",63),o(63,"\u{1F534} Alta"),i()()()(),a(64,"div",46)(65,"div",39)(66,"label",64),o(67,"Asignado a"),i(),a(68,"app-user-selector",65),f("userSelected",function(l){_(t);let d=c();return v(d.onUserAssigned(l))}),i()()()(),a(69,"div",45)(70,"div",46)(71,"div",39)(72,"label",66),o(73,"Fecha L\xEDmite"),i(),u(74,"input",67),i()(),a(75,"div",46)(76,"div",39)(77,"label",68),o(78,"Horas Estimadas"),i(),u(79,"input",69),i()()(),a(80,"div",39)(81,"label",70),o(82,"Etiquetas"),i(),u(83,"input",71),a(84,"small",72),o(85,"Separa m\xFAltiples etiquetas con comas"),i()(),a(86,"div",39)(87,"app-story-points-selector",73),f("pointsSelected",function(l){_(t);let d=c();return v(d.onStoryPointsSelected(l))}),i()(),a(88,"div",39)(89,"label",74),o(90,"Tarea Padre"),i(),a(91,"select",75)(92,"option",49),o(93,"Sin tarea padre"),i(),g(94,Ne,2,2,"option",50),i()()()()(),a(95,"div",36)(96,"app-task-attachments",76),f("attachmentsChanged",function(l){_(t);let d=c();return v(d.onAttachmentsChanged(l))}),i()(),a(97,"div",36),u(98,"app-task-history",77),i()()(),a(99,"div",78)(100,"div",79)(101,"h6",80),o(102,"Acciones R\xE1pidas"),i(),a(103,"div",81)(104,"button",82),f("click",function(){_(t);let l=c();return v(l.saveTask())}),g(105,je,1,0,"span",83)(106,Ge,1,0,"i",84),o(107),i(),g(108,Ue,3,0,"button",85),i(),u(109,"hr"),a(110,"h6",80),o(111,"Informaci\xF3n"),i(),g(112,ze,18,9,"div",86),a(113,"div",87)(114,"h6",80),o(115,"Atajos de Teclado"),i(),a(116,"div",88)(117,"kbd"),o(118,"Ctrl"),i(),o(119," + "),a(120,"kbd"),o(121,"S"),i(),o(122," Guardar "),i(),a(123,"div",88)(124,"kbd"),o(125,"Esc"),i(),o(126," Cerrar "),i()()()()()}if(r&2){let t,n,l,d,h,p=c();s(3),y("active",p.activeTab()==="general"),s(3),y("active",p.activeTab()==="attachments"),s(3),y("active",p.activeTab()==="activity"),s(4),y("active",p.activeTab()==="general"),s(),m("formGroup",p.taskForm),s(6),m("ngIf",((t=p.taskForm.get("title"))==null?null:t.invalid)&&((t=p.taskForm.get("title"))==null?null:t.touched)),s(13),m("ngForOf",p.projects),s(),m("ngIf",((n=p.taskForm.get("projectId"))==null?null:n.invalid)&&((n=p.taskForm.get("projectId"))==null?null:n.touched)),s(34),m("users",p.users)("selectedUserId",(l=p.taskForm.get("assignedTo"))==null?null:l.value)("multiSelect",!1)("allowUnassign",!0)("disabled",p.loading()||p.saving()),s(19),m("selectedPoints",p.getStoryPointsValue())("disabled",p.loading()||p.saving())("showGuide",!0)("showLabels",!0),s(7),m("ngForOf",p.getAvailableParentTasks()),s(),y("active",p.activeTab()==="attachments"),s(),m("taskId",((d=p.taskSignal())==null?null:d.id)||0)("readonly",!1),s(),y("active",p.activeTab()==="activity"),s(),m("taskId",((h=p.taskSignal())==null?null:h.id)||0)("allowComments",!0),s(6),m("disabled",p.taskForm.invalid||p.saving()),s(),m("ngIf",p.saving()),s(),m("ngIf",!p.saving()),s(),x(" ",p.saving()?"Guardando...":"Guardar Cambios"," "),s(),m("ngIf",p.taskSignal()&&!p.loading()),s(4),m("ngIf",p.taskSignal())}}var oe=class r{taskId;task;projects=[];users=[];activeModal=k(te);taskService=k(B);authService=k(D);confirmService=k(ne);fb=k(G);taskSignal=b(null);loading=b(!0);saving=b(!1);error=b(null);activeTab=b("general");taskForm;availableParentTasks=b([]);constructor(){this.taskForm=this.fb.group({title:["",T.required],description:[""],projectId:["",T.required],status:["CREATED"],priority:["medium"],assignedTo:[""],dueDate:[""],estimatedHours:[""],storyPoints:[""],labelsString:[""],parentTaskId:[""]})}ngOnInit(){this.loadTask()}loadTask(){if(this.task){this.taskSignal.set(this.task),this.populateForm(this.task),this.loading.set(!1);return}this.taskId?this.taskService.getTask(this.taskId).subscribe({next:e=>{this.taskSignal.set(e),this.populateForm(e),this.loading.set(!1)},error:e=>{this.error.set("Error al cargar los detalles de la tarea"),this.loading.set(!1)}}):(this.error.set("No se proporcion\xF3 ID de tarea u objeto de tarea"),this.loading.set(!1))}populateForm(e){this.taskForm.patchValue({title:e.title,description:e.description||"",projectId:e.projectId,status:e.status,priority:e.priority||"medium",assignedTo:e.assignedTo||"",dueDate:e.dueDate?new Date(e.dueDate).toISOString().split("T")[0]:"",estimatedHours:e.estimatedHours||"",storyPoints:e.storyPoints||"",labelsString:e.labels?.join(", ")||"",parentTaskId:e.parentTaskId||""}),this.loadAvailableParentTasks(e.projectId,e.id)}saveTask(){if(this.taskForm.invalid)return;let e=this.taskSignal(),t=this.taskId||e?.id;if(!t){this.error.set("No hay ID de tarea disponible");return}this.saving.set(!0);let n=this.taskForm.value;if(!this.authService.getCurrentUser()){this.error.set("Usuario no autenticado"),this.saving.set(!1);return}let d={title:n.title,description:n.description,projectId:parseInt(n.projectId),status:n.status,priority:n.priority,assignedTo:n.assignedTo||void 0,dueDate:n.dueDate?new Date(n.dueDate):void 0,estimatedHours:n.estimatedHours?parseFloat(n.estimatedHours):void 0,storyPoints:n.storyPoints?parseInt(n.storyPoints):void 0,labels:n.labelsString?n.labelsString.split(",").map(h=>h.trim()).filter(h=>h):[],parentTaskId:n.parentTaskId?parseInt(n.parentTaskId):void 0};this.taskService.updateTask(t,d).subscribe({next:h=>{this.saving.set(!1),this.activeModal.close(h)},error:h=>{this.error.set("Error al actualizar la tarea"),this.saving.set(!1)}})}deleteTask(){let e=this.taskSignal(),t=this.taskId||e?.id;if(!t){this.error.set("No hay ID de tarea disponible");return}let n=e?.title||"esta tarea";this.confirmService.confirmWithAction({title:"Eliminar Tarea",message:`\xBFEst\xE1s seguro de que quieres eliminar "${n}"? Esta acci\xF3n no se puede deshacer.`,confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger"},()=>this.taskService.deleteTask(t)).subscribe({next:l=>{l!==null&&this.activeModal.close({deleted:!0})},error:l=>{console.error("Error deleting task:",l),this.error.set("Error al eliminar la tarea. Int\xE9ntalo de nuevo.")}})}loadAvailableParentTasks(e,t){this.authService.getCurrentUser()&&this.taskService.getProjectTasks(e).subscribe({next:l=>{let d=l.filter(h=>!(t&&h.id===t));this.availableParentTasks.set(d)},error:l=>{console.error("Error loading parent tasks:",l),this.availableParentTasks.set([])}})}getAvailableParentTasks(){return this.availableParentTasks()}onProjectChange(){let e=this.taskForm.get("projectId")?.value;if(e){let t=this.taskSignal();this.loadAvailableParentTasks(parseInt(e),t?.id)}else this.availableParentTasks.set([])}setActiveTab(e){this.activeTab.set(e)}onAttachmentsChanged(e){console.log("Attachments changed:",e)}onUserAssigned(e){this.taskForm.patchValue({assignedTo:e?.id||""});let t=this.taskSignal();t&&this.taskSignal.set(E(S({},t),{assignedTo:e?.id}))}onStoryPointsSelected(e){this.taskForm.patchValue({storyPoints:e||""});let t=this.taskSignal();t&&this.taskSignal.set(E(S({},t),{storyPoints:e||void 0}))}getStoryPointsValue(){let e=this.taskForm.get("storyPoints")?.value;return!e||e===""?null:parseInt(e)}getProjectIdValue(){let e=this.taskForm.get("projectId")?.value;return e?parseInt(e):null}getSelectedProject(){let e=this.getProjectIdValue();return this.projects.find(t=>t.id===e)}handleKeyboardEvent(e){e.ctrlKey&&e.key==="s"&&(e.preventDefault(),!this.taskForm.invalid&&!this.saving()&&this.saveTask()),e.key==="Escape"&&(e.preventDefault(),this.activeModal.dismiss())}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=M({type:r,selectors:[["app-task-detail-modal"]],hostBindings:function(t,n){t&1&&f("keydown",function(d){return n.handleKeyboardEvent(d)},!1,R)},inputs:{taskId:"taskId",task:"task",projects:"projects",users:"users"},decls:19,vars:9,consts:[[1,"fullscreen-modal"],[1,"modal-header-fullscreen"],[1,"d-flex","align-items-center"],[1,"task-type-badge","me-3"],[1,"fas","fa-tasks"],["class","mb-0 fw-bold text-white",4,"ngIf"],["class","text-white-50",4,"ngIf"],[1,"d-flex","align-items-center","gap-2"],["type","button","title","Guardar (Ctrl+S)",1,"btn","btn-link","text-white",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],["class","fas fa-save",4,"ngIf"],["type","button","title","Cerrar (Esc)",1,"btn","btn-link","text-white",3,"click"],[1,"fas","fa-times"],[1,"modal-content-fullscreen"],["class","loading-overlay",4,"ngIf"],["class","alert alert-danger m-4","role","alert",4,"ngIf"],["class","d-flex h-100",4,"ngIf"],[1,"mb-0","fw-bold","text-white"],[1,"text-white-50"],[1,"spinner-border","spinner-border-sm"],[1,"fas","fa-save"],[1,"loading-overlay"],[1,"text-center"],["role","status",1,"spinner-border","text-primary","mb-3"],[1,"visually-hidden"],[1,"text-muted"],["role","alert",1,"alert","alert-danger","m-4"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"d-flex","h-100"],[1,"form-section"],[1,"tabs-nav"],["type","button",1,"tab-btn",3,"click"],[1,"fas","fa-info-circle","me-2"],[1,"fas","fa-paperclip","me-2"],[1,"fas","fa-history","me-2"],[1,"tab-content-area"],[1,"tab-pane","h-100"],[1,"h-100",3,"formGroup"],[1,"form-scroll"],[1,"form-group"],["for","title",1,"form-label"],["type","text","id","title","formControlName","title","placeholder","Ingresa el t\xEDtulo de la tarea",1,"form-control","form-control-lg"],["class","invalid-feedback",4,"ngIf"],["for","description",1,"form-label"],["id","description","rows","6","formControlName","description","placeholder","Describe la tarea en detalle...",1,"form-control"],[1,"row"],[1,"col-lg-6"],["for","project",1,"form-label"],["id","project","formControlName","projectId",1,"form-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","status",1,"form-label"],["id","status","formControlName","status",1,"form-select"],["value","CREATED"],["value","IN_PROGRESS"],["value","BLOCKED"],["value","TESTING"],["value","READY_TO_FINISH"],["value","FINISHED"],["for","priority",1,"form-label"],["id","priority","formControlName","priority",1,"form-select"],["value","low"],["value","medium"],["value","high"],[1,"form-label"],["placeholder","Seleccionar asignado...",3,"userSelected","users","selectedUserId","multiSelect","allowUnassign","disabled"],["for","dueDate",1,"form-label"],["type","date","id","dueDate","formControlName","dueDate",1,"form-control"],["for","estimatedHours",1,"form-label"],["type","number","id","estimatedHours","formControlName","estimatedHours","min","0","step","0.5","placeholder","0",1,"form-control"],["for","labels",1,"form-label"],["type","text","id","labels","formControlName","labelsString","placeholder","frontend, urgent, bug (separadas por comas)",1,"form-control"],[1,"form-text","text-muted"],[3,"pointsSelected","selectedPoints","disabled","showGuide","showLabels"],["for","parentTask",1,"form-label"],["id","parentTask","formControlName","parentTaskId",1,"form-select"],[3,"attachmentsChanged","taskId","readonly"],[3,"taskId","allowComments"],[1,"sidebar-section"],[1,"sidebar-content"],[1,"sidebar-title"],[1,"action-buttons"],["type","button",1,"btn","btn-success","btn-sm","w-100","mb-2",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-save me-2",4,"ngIf"],["type","button","class","btn btn-outline-danger btn-sm w-100",3,"click",4,"ngIf"],["class","info-items",4,"ngIf"],[1,"keyboard-shortcuts","mt-4"],[1,"shortcut-item"],[1,"invalid-feedback"],[3,"value"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-save","me-2"],["type","button",1,"btn","btn-outline-danger","btn-sm","w-100",3,"click"],[1,"fas","fa-trash","me-2"],[1,"info-items"],[1,"info-item"],[1,"info-label"],[1,"info-value"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u(4,"i",4),i(),a(5,"div"),g(6,Ee,2,1,"h3",5)(7,Me,2,0,"h3",5)(8,Pe,2,1,"small",6),i()(),a(9,"div",7)(10,"button",8),f("click",function(){return n.saveTask()}),g(11,we,1,0,"span",9)(12,Oe,1,0,"i",10),i(),a(13,"button",11),f("click",function(){return n.activeModal.dismiss()}),u(14,"i",12),i()()(),a(15,"div",13),g(16,De,7,0,"div",14)(17,Fe,3,1,"div",15)(18,Be,127,36,"div",16),i()()),t&2&&(s(6),m("ngIf",n.taskSignal()),s(),m("ngIf",!n.taskSignal()),s(),m("ngIf",n.getSelectedProject()),s(2),m("disabled",n.taskForm.invalid||n.saving()),s(),m("ngIf",n.saving()),s(),m("ngIf",!n.saving()),s(4),m("ngIf",n.loading()),s(),m("ngIf",n.error()),s(),m("ngIf",!n.loading()&&!n.error()))},dependencies:[O,P,w,W,U,A,X,Z,F,J,Q,H,V,ee,z,N,j,$,ie,ae,re],styles:['.fullscreen-modal[_ngcontent-%COMP%]{position:fixed;inset:0;background:#fff;z-index:1050;display:flex;flex-direction:column}.modal-header-fullscreen[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px #0000001a;z-index:10}.task-type-badge[_ngcontent-%COMP%]{width:48px;height:48px;background:#fff3;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.25rem}.modal-content-fullscreen[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.loading-overlay[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}.form-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-width:0}.sidebar-section[_ngcontent-%COMP%]{width:300px;background:#f8fafc;border-left:1px solid #e5e7eb;display:flex;flex-direction:column}.sidebar-content[_ngcontent-%COMP%]{padding:1.5rem;flex:1;overflow-y:auto}.sidebar-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#374151;margin-bottom:1rem;text-transform:uppercase;letter-spacing:.05em}.tabs-nav[_ngcontent-%COMP%]{display:flex;background:#f8fafc;border-bottom:1px solid #e5e7eb;padding:0 2rem}.tab-btn[_ngcontent-%COMP%]{background:none;border:none;padding:1rem 1.5rem;color:#6b7280;font-size:.875rem;font-weight:500;cursor:pointer;position:relative;transition:all .2s ease}.tab-btn[_ngcontent-%COMP%]:hover{color:#374151;background:#667eea0d}.tab-btn.active[_ngcontent-%COMP%]{color:#667eea;background:#fff}.tab-btn.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:0;right:0;height:2px;background:#667eea}.tab-content-area[_ngcontent-%COMP%]{flex:1;overflow:hidden}.tab-pane[_ngcontent-%COMP%]{display:none;padding:2rem;overflow-y:auto}.tab-pane.active[_ngcontent-%COMP%]{display:block}.form-scroll[_ngcontent-%COMP%]{max-width:800px}.form-group[_ngcontent-%COMP%]{margin-bottom:2rem}.form-label[_ngcontent-%COMP%]{color:#374151;font-weight:600;margin-bottom:.5rem;display:block;font-size:.875rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border:1px solid #d1d5db;border-radius:.5rem;padding:.75rem 1rem;font-size:.875rem;transition:all .2s ease}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#667eea;box-shadow:0 0 0 3px #667eea1a;outline:none}.form-control-lg[_ngcontent-%COMP%]{padding:1rem 1.25rem;font-size:1.1rem;font-weight:500}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:120px}.action-buttons[_ngcontent-%COMP%]{margin-bottom:1.5rem}.info-items[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid #f3f4f6}.info-items[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-items[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{color:#6b7280;font-size:.75rem;font-weight:500;text-transform:uppercase;letter-spacing:.05em}.info-items[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{color:#374151;font-weight:500;font-size:.875rem}.keyboard-shortcuts[_ngcontent-%COMP%]   .shortcut-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.5rem;font-size:.75rem;color:#6b7280}.keyboard-shortcuts[_ngcontent-%COMP%]   .shortcut-item[_ngcontent-%COMP%]   kbd[_ngcontent-%COMP%]{background:#374151;color:#fff;padding:.25rem .5rem;border-radius:.25rem;font-size:.625rem;margin:0 .25rem}.btn-link[_ngcontent-%COMP%]{text-decoration:none;padding:.5rem;border-radius:.375rem;transition:all .2s ease}.btn-link[_ngcontent-%COMP%]:hover{background:#ffffff1a}@media (max-width: 768px){.sidebar-section[_ngcontent-%COMP%]{width:250px}.tab-content-area[_ngcontent-%COMP%]   .tab-pane[_ngcontent-%COMP%], .modal-header-fullscreen[_ngcontent-%COMP%]{padding:1rem}.tabs-nav[_ngcontent-%COMP%]{padding:0 1rem}.tab-btn[_ngcontent-%COMP%]{padding:.75rem 1rem;font-size:.8rem}}@media (max-width: 576px){.form-section[_ngcontent-%COMP%]{flex-direction:column}.sidebar-section[_ngcontent-%COMP%]{width:100%;max-height:200px;border-left:none;border-top:1px solid #e5e7eb}.sidebar-content[_ngcontent-%COMP%]{padding:1rem}}']})};export{oe as a};
