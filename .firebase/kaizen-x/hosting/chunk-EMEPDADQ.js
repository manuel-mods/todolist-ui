import{a as Y,b as w}from"./chunk-BIWH6YEI.js";import"./chunk-OFQQDMTS.js";import{a as J}from"./chunk-SVIYRKC5.js";import"./chunk-WKW57PVX.js";import"./chunk-P2AP2LDR.js";import{b as D,d as V,f as H,k as Q,l as q,m as K,p as R}from"./chunk-B6CTW34R.js";import{a as G,b as X}from"./chunk-TB2JPHKQ.js";import"./chunk-5IMW6SUT.js";import{r as A}from"./chunk-UEBHN7X3.js";import{Cb as a,Cc as L,Db as i,Dc as N,Eb as y,Fb as B,Gb as p,Ha as m,Hb as v,Ic as U,Mb as E,Nb as F,Ob as z,Qb as s,Rb as k,Sb as I,Tb as W,Vb as f,Wb as u,Xb as _,a as M,b as O,cb as l,d as x,ma as C,mb as j,qb as g,ua as S,va as T,xb as d}from"./chunk-HT5E4KE5.js";function $(c,n){if(c&1&&(a(0,"option",26),s(1),i()),c&2){let t=n.$implicit;d("value",t.id),l(),I(" ",t.name," ")}}function ee(c,n){if(c&1){let t=B();a(0,"div",3)(1,"span",27),s(2),i(),a(3,"button",28),p("click",function(){S(t);let r=v();return T(r.clearProjectSelection())}),y(4,"i",29),i()()}if(c&2){let t,e=v();l(2),k((t=e.selectedProject())==null?null:t.name)}}function te(c,n){if(c&1&&(a(0,"option",26),s(1),i()),c&2){let t=n.$implicit;d("value",t.id),l(),k(t.name)}}function ne(c,n){if(c&1&&(a(0,"option",26),s(1),i()),c&2){let t=n.$implicit;d("value",t.id),l(),k(t.name)}}function oe(c,n){if(c&1&&(a(0,"option",26),s(1),i()),c&2){let t=n.$implicit;d("value",t.name),l(),k(t.name)}}var Z=class c{kanbanBoard;taskService=C(J);projectService=C(G);userService=C(Y);authService=C(A);tasks=m([]);projects=m([]);users=m([]);labels=m([]);loading=m(!0);showFilters=m(!1);selectedProject=m(null);headerActions=[{label:"Nueva Tarea",icon:"fas fa-plus",action:()=>this.createNewTask(),variant:"primary"},{label:"Filtros",icon:"fas fa-filter",action:()=>this.toggleFilters(),variant:"outline"}];filters={project:"",assignee:"",priority:"",label:"",search:""};filteredTasks=[];ngOnInit(){this.loadBoardData()}loadBoardData(){return x(this,null,function*(){try{let n=this.authService.getCurrentUser();if(!n){this.loading.set(!1);return}let t=yield this.projectService.getUserProjects(n.id).toPromise();if(!t){this.loading.set(!1);return}let e=[...t.owned,...t.shared];this.projects.set(e);let r=[];for(let o of e)if(o.tasks&&o.tasks.length>0){let b=o.tasks.map(P=>O(M({},P),{projectName:o.name}));r.push(...b)}this.tasks.set(r),this.filteredTasks=r,this.loading.set(!1)}catch(n){console.error("Error loading board data:",n),this.loading.set(!1)}})}toggleFilters(){this.showFilters.set(!this.showFilters())}clearFilters(){this.filters={project:"",assignee:"",priority:"",label:"",search:""},this.applyFilters()}applyFilters(){let n=this.tasks();if(this.selectedProject()&&(n=n.filter(t=>t.projectId===this.selectedProject().id)),this.filters.project&&(n=n.filter(t=>t.projectId.toString()===this.filters.project)),this.filters.assignee&&(n=n.filter(t=>t.assignedTo===this.filters.assignee)),this.filters.priority&&(n=n.filter(t=>t.priority===this.filters.priority)),this.filters.label&&(n=n.filter(t=>t.labels&&t.labels.some(e=>e.includes(this.filters.label)))),this.filters.search){let t=this.filters.search.toLowerCase();n=n.filter(e=>e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t))}this.filteredTasks=n}getTasksByStatus(n){return this.filteredTasks.filter(t=>t.status===n)}createNewTask(){this.kanbanBoard&&this.kanbanBoard.createTask()}onTaskCreated(n){this.loadBoardData()}onTaskUpdated(n){this.tasks.update(t=>t.map(e=>e.id===n.id?n:e)),this.applyFilters()}onTaskStatusChanged(n){let{task:t,newStatus:e,previousStatus:r}=n,o=this.authService.getCurrentUser();if(!o)return;let b=[...this.tasks()],P=b.findIndex(h=>h.id===t.id);P>-1&&(b[P]=O(M({},t),{status:e}),this.tasks.set(b),this.applyFilters()),this.taskService.updateTaskStatus(t.id,{newStatus:e,userId:o.id}).subscribe({next:h=>{console.log("Task status updated successfully:",h)},error:h=>{console.error("Failed to update task status:",h),t.status=r,this.loadBoardData()}})}onProjectSelected(n){this.selectedProject.set(n),this.applyFilters()}onProjectSelectChange(n){let e=n.target.value;if(e){let r=this.projects().find(o=>o.id.toString()===e);this.onProjectSelected(r||null)}else this.onProjectSelected(null)}clearProjectSelection(){this.selectedProject.set(null),this.applyFilters()}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=j({type:c,selectors:[["app-board"]],viewQuery:function(t,e){if(t&1&&E(w,5),t&2){let r;F(r=z())&&(e.kanbanBoard=r.first)}},decls:59,vars:21,consts:[["title","Tablero","subtitle","Vista Kanban de todas las tareas en todos los proyectos",3,"actions","showFilters"],[1,"project-selector","mb-3"],[1,"d-flex","align-items-center","gap-3"],[1,"d-flex","align-items-center","gap-2"],[1,"form-label","mb-0","fw-semibold"],[1,"form-select","form-select-sm",2,"min-width","200px",3,"change","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","d-flex align-items-center gap-2",4,"ngIf"],[1,"card","card-notion"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-3"],[1,"form-label","small","fw-medium"],[1,"form-select","form-select-sm",3,"ngModelChange","change","ngModel"],[1,"col-md-2"],["value","high"],["value","medium"],["value","low"],["type","text","placeholder","Buscar tareas...",1,"form-control","form-control-sm",3,"ngModelChange","keyup","ngModel"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"fas","fa-times","me-1"],[1,"text-muted"],[3,"taskStatusChanged","taskCreated","taskUpdated","tasks","projects","users","loading","showProject","allowCreateTask"],[3,"value"],[1,"badge","bg-primary"],["type","button","title","Limpiar selecci\xF3n",1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"fas","fa-times"]],template:function(t,e){if(t&1&&(a(0,"app-page-header",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),s(5,"Proyecto:"),i(),a(6,"select",5),p("change",function(o){return e.onProjectSelectChange(o)}),a(7,"option",6),s(8,"Todos los Proyectos"),i(),g(9,$,2,2,"option",7),i()(),g(10,ee,5,1,"div",8),i()(),a(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"label",13),s(16,"Proyecto"),i(),a(17,"select",14),_("ngModelChange",function(o){return u(e.filters.project,o)||(e.filters.project=o),o}),p("change",function(){return e.applyFilters()}),a(18,"option",6),s(19,"Todos los Proyectos"),i(),g(20,te,2,2,"option",7),i()(),a(21,"div",15)(22,"label",13),s(23,"Asignado"),i(),a(24,"select",14),_("ngModelChange",function(o){return u(e.filters.assignee,o)||(e.filters.assignee=o),o}),p("change",function(){return e.applyFilters()}),a(25,"option",6),s(26,"Todos los Asignados"),i(),g(27,ne,2,2,"option",7),i()(),a(28,"div",15)(29,"label",13),s(30,"Prioridad"),i(),a(31,"select",14),_("ngModelChange",function(o){return u(e.filters.priority,o)||(e.filters.priority=o),o}),p("change",function(){return e.applyFilters()}),a(32,"option",6),s(33,"Todas las Prioridades"),i(),a(34,"option",16),s(35,"Alta"),i(),a(36,"option",17),s(37,"Media"),i(),a(38,"option",18),s(39,"Baja"),i()()(),a(40,"div",15)(41,"label",13),s(42,"Etiquetas"),i(),a(43,"select",14),_("ngModelChange",function(o){return u(e.filters.label,o)||(e.filters.label=o),o}),p("change",function(){return e.applyFilters()}),a(44,"option",6),s(45,"Todas las Etiquetas"),i(),g(46,oe,2,2,"option",7),i()(),a(47,"div",12)(48,"label",13),s(49,"Buscar"),i(),a(50,"input",19),_("ngModelChange",function(o){return u(e.filters.search,o)||(e.filters.search=o),o}),p("keyup",function(){return e.applyFilters()}),i()()(),a(51,"div",20)(52,"div",21)(53,"button",22),p("click",function(){return e.clearFilters()}),y(54,"i",23),s(55,"Limpiar Todo "),i()(),a(56,"small",24),s(57),i()()()()(),a(58,"app-kanban-board",25),p("taskStatusChanged",function(o){return e.onTaskStatusChanged(o)})("taskCreated",function(o){return e.onTaskCreated(o)})("taskUpdated",function(o){return e.onTaskUpdated(o)}),i()),t&2){let r;d("actions",e.headerActions)("showFilters",e.showFilters()),l(6),d("value",((r=e.selectedProject())==null?null:r.id)||""),l(3),d("ngForOf",e.projects()),l(),d("ngIf",e.selectedProject()),l(7),f("ngModel",e.filters.project),l(3),d("ngForOf",e.projects()),l(4),f("ngModel",e.filters.assignee),l(3),d("ngForOf",e.users()),l(4),f("ngModel",e.filters.priority),l(12),f("ngModel",e.filters.label),l(3),d("ngForOf",e.labels()),l(4),f("ngModel",e.filters.search),l(7),W("",e.filteredTasks.length," de ",e.tasks().length," tareas mostradas"),l(),d("tasks",e.filteredTasks)("projects",e.projects())("users",e.users())("loading",e.loading())("showProject",!0)("allowCreateTask",!0)}},dependencies:[U,L,N,R,q,K,D,Q,V,H,X,w],styles:['.board-container[_ngcontent-%COMP%]{background:#fafafa;padding:1rem}.project-selector[_ngcontent-%COMP%]{background:#fff;border-radius:8px;border:1px solid #e5e5e5;padding:1rem}.project-selector[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{color:#1a1a1a;font-size:.875rem}.project-selector[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{border:1px solid #d0d0d0;border-radius:6px;font-size:.875rem}.project-selector[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:focus{border-color:#6366f1;box-shadow:0 0 0 .2rem #6366f140}.project-selector[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}.project-selector[_ngcontent-%COMP%]   .btn-outline-secondary[_ngcontent-%COMP%]{--bs-btn-border-color: #d0d0d0;--bs-btn-color: #666;--bs-btn-hover-bg: #f5f5f5;--bs-btn-hover-border-color: #a0a0a0;--bs-btn-hover-color: #1a1a1a;font-size:.75rem;padding:.25rem .5rem;border-radius:4px}.board-stats[_ngcontent-%COMP%]{display:flex;gap:2rem;flex-wrap:wrap}.board-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.board-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-weight:600;color:#1a1a1a;margin-right:.25rem}.kanban-board[_ngcontent-%COMP%]{display:flex;gap:1rem;overflow-x:auto;padding-bottom:1rem;min-height:70vh}.kanban-column[_ngcontent-%COMP%]{flex:1;min-width:280px;background:#fff;border-radius:8px;border:1px solid #e5e5e5;display:flex;flex-direction:column}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]{padding:1rem 1rem .5rem;border-bottom:1px solid #f0f0f0}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .column-title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .column-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#1a1a1a;margin:0;text-transform:uppercase;letter-spacing:.05em}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .column-title[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#f5f5f5;color:#666;font-size:.75rem;font-weight:500;padding:.25rem .5rem;border-radius:12px;min-width:1.5rem;text-align:center}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .add-task-btn[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px dashed #d0d0d0;background:transparent;color:#666;border-radius:4px;font-size:.75rem;cursor:pointer;transition:all .2s ease}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .add-task-btn[_ngcontent-%COMP%]:hover{border-color:#a0a0a0;color:#1a1a1a;background:#f9f9f9}.kanban-column[_ngcontent-%COMP%]   .column-header[_ngcontent-%COMP%]   .add-task-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}.kanban-column[_ngcontent-%COMP%]   .column-content[_ngcontent-%COMP%]{flex:1;padding:.5rem;min-height:200px}.kanban-column.column-created[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#f0f0f0}.kanban-column.column-progress[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.kanban-column.column-blocked[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.kanban-column.column-testing[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#fff3e0;color:#ef6c00}.kanban-column.column-ready[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#e0f2f1;color:#00695c}.kanban-column.column-finished[_ngcontent-%COMP%]   .task-count[_ngcontent-%COMP%]{background:#e8f5e8;color:#2e7d32}.task-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e8e8e8;border-radius:6px;padding:.75rem;margin-bottom:.5rem;cursor:pointer;transition:all .2s ease;position:relative}.task-card[_ngcontent-%COMP%]:hover{border-color:#d0d0d0;box-shadow:0 2px 8px #0000001a}.task-card[_ngcontent-%COMP%]:last-child{margin-bottom:0}.task-card[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#1a1a1a;line-height:1.4;margin-bottom:.5rem}.task-card[_ngcontent-%COMP%]   .task-description[_ngcontent-%COMP%]{font-size:.8rem;color:#666;line-height:1.4;margin-bottom:.75rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:between;gap:.5rem}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]   .task-labels[_ngcontent-%COMP%]{display:flex;gap:.25rem;flex:1}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]   .task-labels[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{background:#f5f5f5;color:#666;font-size:.7rem;padding:.125rem .375rem;border-radius:3px;font-weight:500}.task-card[_ngcontent-%COMP%]   .task-meta[_ngcontent-%COMP%]   .task-assignee[_ngcontent-%COMP%]{width:24px;height:24px;background:#e0e0e0;color:#666;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:600;text-transform:uppercase}.task-card[_ngcontent-%COMP%]   .task-priority[_ngcontent-%COMP%]{position:absolute;top:.75rem;right:.75rem;width:6px;height:6px;border-radius:50%}.task-card[_ngcontent-%COMP%]   .task-priority.priority-high[_ngcontent-%COMP%]{background:#f44336}.task-card[_ngcontent-%COMP%]   .task-priority.priority-medium[_ngcontent-%COMP%]{background:#ff9800}.task-card[_ngcontent-%COMP%]   .task-priority.priority-low[_ngcontent-%COMP%]{background:#4caf50}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:6px;box-shadow:0 8px 24px #0003;transform:rotate(3deg);background:#fff;border:1px solid #d0d0d0}.cdk-drag-preview[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]{color:#1a1a1a!important}.cdk-drag-preview[_ngcontent-%COMP%]   .task-description[_ngcontent-%COMP%]{color:#666!important}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3;border:2px dashed #a0a0a0;background:linear-gradient(45deg,#f0f0f0 25%,transparent 25%,transparent 75%,#f0f0f0 75%,#f0f0f0),linear-gradient(45deg,#f0f0f0 25%,transparent 25%,transparent 75%,#f0f0f0 75%,#f0f0f0);background-size:8px 8px;background-position:0 0,4px 4px;border-radius:6px;min-height:60px;display:flex;align-items:center;justify-content:center}.cdk-drag-placeholder[_ngcontent-%COMP%]:before{content:"Drop here";color:#999;font-size:.75rem;font-weight:500}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .3s cubic-bezier(.4,0,.2,1)}.cdk-drop-list[_ngcontent-%COMP%]{min-height:100px;transition:background-color .25s ease;border-radius:4px}.cdk-drop-list.cdk-drop-list-receiving[_ngcontent-%COMP%]{background-color:#6366f10d;border:2px dashed rgba(99,102,241,.3)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .3s cubic-bezier(.4,0,.2,1)}.cdk-drag[_ngcontent-%COMP%]{cursor:grab}.cdk-drag[_ngcontent-%COMP%]:active{cursor:grabbing}.cdk-drag.cdk-drag-disabled[_ngcontent-%COMP%]{cursor:default;opacity:.6}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem;color:#999}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;margin:0}@media (max-width: 1024px){.kanban-board[_ngcontent-%COMP%]{gap:.75rem}.kanban-column[_ngcontent-%COMP%]{min-width:250px}}@media (max-width: 768px){.board-container[_ngcontent-%COMP%]{padding:1rem .5rem}.kanban-board[_ngcontent-%COMP%]{gap:.5rem}.kanban-column[_ngcontent-%COMP%]{min-width:220px}.board-header[_ngcontent-%COMP%]   .board-stats[_ngcontent-%COMP%]{flex-wrap:wrap;gap:1rem}}']})};export{Z as BoardComponent};
